!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t=t||self).triangulate=n()}(this,function(){"use strict";function o(t,n,e){return t<n?n:e<t?e:t}var u=function(t,n){void 0===t&&(t=300),void 0===n&&(n=150),"undefined"==typeof window?(this.canvasEl={width:t,height:n},this.ctx=null):(this.canvasEl=document.createElement("canvas"),this.canvasEl.width=t,this.canvasEl.height=n,this.ctx=this.canvasEl.getContext("2d"))},t={width:{configurable:!0},height:{configurable:!0}};function i(t,n,e,a){var r=!(!n||!n.backgroundColor)&&n.backgroundColor,o=new u(t.width*e,t.height*e,a),i=o.getContext("2d");return r&&(i.fillStyle=r,i.fillRect(0,0,t.width*e,t.height*e),i.fillStyle="transparent"),{canvas:o,ctx:i}}u.prototype.getContext=function(){return this.ctx},u.prototype.toDataURL=function(t,n,e){if("function"!=typeof e)return this.canvasEl.toDataURL(t,n);e(this.canvasEl.toDataURL(t,n))},t.width.get=function(){return this.canvasEl.width},t.width.set=function(t){this.canvasEl.width=t},t.height.get=function(){return this.canvasEl.height},t.height.set=function(t){this.canvasEl.height=t},Object.defineProperties(u.prototype,t),"undefined"!=typeof window&&(u.Image=Image);var n={accuracy:.7,blur:4,fill:!0,stroke:!0,strokeWidth:.5,lineJoin:"miter",vertexCount:700,threshold:50,transparentColor:!1},e=["miter","round","bevel"];function p(t){return"object"!=typeof(t=function(t){var n=!1;if(void 0!==t)try{n=JSON.parse(JSON.stringify(t))}catch(t){}return n}(t))&&(t={}),"number"!=typeof t.accuracy||isNaN(t.accuracy)?t.accuracy=n.accuracy:t.accuracy=o(t.accuracy,0,1),"number"==typeof t.blur&&!isNaN(t.blur)||(t.blur=n.blur),t.blur<=0&&(t.blur=1),"string"!=typeof t.fill&&"boolean"!=typeof t.fill&&(t.fill=n.fill),"string"!=typeof t.stroke&&"boolean"!=typeof t.stroke&&(t.stroke=n.stroke),"number"==typeof t.strokeWidth&&!isNaN(t.strokeWidth)||(t.strokeWidth=n.strokeWidth),"number"!=typeof t.threshold||isNaN(t.threshold)?t.threshold=n.threshold:t.threshold=o(t.threshold,1,100),"string"==typeof t.lineJoin&&-1!==e.indexOf(t.lineJoin)||(t.lineJoin=n.lineJoin),t.gradients&&t.fill?t.gradients=!0:t.gradients=!1,t.gradients&&(("number"!=typeof t.gradientStops||isNaN(t.gradientStops)||t.gradientStops<2)&&(t.gradientStops=2),t.gradientStops=Math.round(t.gradientStops)),"number"==typeof t.vertexCount&&!isNaN(t.vertexCount)||(t.vertexCount=n.vertexCount),t.vertexCount<=0&&(t.vertexCount=1),"string"!=typeof t.transparentColor&&"boolean"!=typeof t.transparentColor&&(t.transparentColor=n.transparentColor),!0===typeof t.transparentColor&&(t.transparentColor=!1),"string"==typeof t.transparentColor&&(t.transparentColor=function(t){var n=i({width:1,height:1},{},1,!0).ctx;n.fillStyle=t,n.fillRect(0,0,1,1);var e=n.getImageData(0,0,1,1).data;return{r:e[0],g:e[1],b:e[2],a:e[3]/255}}(t.transparentColor)),t}function x(t){if(t instanceof HTMLImageElement){if(!t.naturalWidth||!t.naturalHeight||!1===t.complete)throw new Error("This this image hasn't finished loading: "+t.src);var n=new u(t.naturalWidth,t.naturalHeight),e=n.getContext("2d");e.drawImage(t,0,0,n.width,n.height);var a=e.getImageData(0,0,n.width,n.height);return a.data&&a.data.length&&(void 0===a.width&&(a.width=t.naturalWidth),void 0===a.height&&(a.height=t.naturalHeight)),a}throw new Error("This object does not seem to be an image.")}var m=Object.assign;function s(t){var n=m({a:1},t);return"rgba("+n.r+", "+n.g+", "+n.b+", "+n.a+")"}function h(e,t,n,o){return o=o||1,t.forEach(function(t,n){if(e.beginPath(),e.moveTo(t.a.x*o,t.a.y*o),e.lineTo(t.b.x*o,t.b.y*o),e.lineTo(t.c.x*o,t.c.y*o),e.lineTo(t.a.x*o,t.a.y*o),t.gradient){var a=e.createLinearGradient(t.gradient.x1*o,t.gradient.y1*o,t.gradient.x2*o,t.gradient.y2*o),r=t.gradient.colors.length-1;t.gradient.colors.forEach(function(t,n){var e=s(t);console.log(t),a.addColorStop(n/r,e)}),e.fillStyle=a,e.fill(),0<t.strokeWidth&&(e.strokeStyle=a,e.lineWidth=t.strokeWidth*o,e.lineJoin=t.lineJoin,e.stroke())}else t.fill&&(e.fillStyle=s(t.fill),e.fill()),t.strokeColor&&(e.strokeStyle=s(t.strokeColor),e.lineWidth=t.strokeWidth*o,e.lineJoin=t.lineJoin,e.stroke());e.closePath()}),e}function v(t,n,e){var a=e&&e.dpr?e.dpr:1,r=i(n,e,a,!0).ctx;return h(r,t,0,a),r.getImageData(0,0,n.width*a,n.height*a)}function w(t,n,e){var a=e&&e.dpr?e.dpr:1,r=i(n,e,a);return h(r.ctx,t,0,a),r.canvas.toDataURL()}function r(t){var n=t.toString(16);return 1==n.length?"0"+n:n}function b(t){var n=t.r,e=t.g,a=t.b;return"#"+r(n)+r(e)+r(a)}function C(t,n){var y="";t.length&&t[0].gradient&&(y="<defs>");var p="";return t.forEach(function(t,n){var e=t.a,a=t.b,r=t.c;if(p+='<polygon points="'+e.x+","+e.y+" "+a.x+","+a.y+" "+r.x+","+r.y+'"',t.gradient){var o=t.boundingBox,i=((t.gradient.x1-o.x)/o.width*100).toFixed(3),u=((t.gradient.y1-o.y)/o.height*100).toFixed(3),s=((t.gradient.x2-o.x)/o.width*100).toFixed(3),h=((t.gradient.y2-o.y)/o.height*100).toFixed(3);y+='\n\t<linearGradient id="gradient-'+n+'" x1="'+i+'%" y1="'+u+'%" x2="'+s+'%" y2="'+h+'%">';var c=t.gradient.colors.length-1;t.gradient.colors.forEach(function(t,n){var e=b(t),a=t.a<1?' stop-opacity="'+t.a+'"':"",r=(n/c*100).toFixed(3);y+='\n\t\t\t\t\t<stop offset="'+r+'%" stop-color="'+e+'"'+a+"/>\n\t\t\t\t"}),y+="</linearGradient>",p+=' fill="url(#gradient-'+n+')"',0<t.strokeWidth&&(p+=' stroke="url(#gradient-'+n+')" stroke-width="'+t.strokeWidth+'" stroke-linejoin="'+t.lineJoin+'"')}else{if(t.fill){var l=b(t.fill),f=t.fill.a<1?' fill-opacity="'+t.fill.a+'"':"";p+=' fill="'+l+'"'+f}else p+=' fill="transparent"';if(t.strokeColor){var d=b(t.strokeColor),g=t.strokeColor.a<1?' stroke-opacity="'+t.strokeColor.a+'"':"";p+=' stroke="'+d+'" stroke-width="'+t.strokeWidth+'" stroke-linejoin="'+t.lineJoin+'"'+g}}p+="/>\n\t"}),y.length&&(y+="\n\t\t</defs>"),'<?xml version="1.0" standalone="yes"?>\n<svg width="'+n.width+'" height="'+n.height+'" xmlns="http://www.w3.org/2000/svg" version="1.1" >\n\t'+y+"\n\t"+p+"\n</svg>"}function a(t,n){return t(n={exports:{}},n.exports),n.exports}var c=a(function(t){function x(t,n,e){this.a=t,this.b=n,this.c=e;var a,r,o,i,u=n.x-t.x,s=n.y-t.y,h=e.x-t.x,c=e.y-t.y,l=u*(t.x+n.x)+s*(t.y+n.y),f=h*(t.x+e.x)+c*(t.y+e.y),d=2*(u*(e.y-n.y)-s*(e.x-n.x));Math.abs(d)<1e-6?(a=Math.min(t.x,n.x,e.x),r=Math.min(t.y,n.y,e.y),o=.5*(Math.max(t.x,n.x,e.x)-a),i=.5*(Math.max(t.y,n.y,e.y)-r),this.x=a+o,this.y=r+i):(this.x=(c*l-s*f)/d,this.y=(u*f-h*l)/d,o=this.x-t.x,i=this.y-t.y),this.r=o*o+i*i}function m(t,n){return n.x-t.x}function v(t){var n,e,a,r,o,i=t.length;t:for(;i;)for(e=t[--i],n=t[--i],a=i;a;)if(o=t[--a],n===(r=t[--a])&&e===o||n===o&&e===r){t.splice(i,2),t.splice(a,2),i-=2;continue t}}x.prototype.draw=function(t){t.beginPath(),t.moveTo(this.a.x,this.a.y),t.lineTo(this.b.x,this.b.y),t.lineTo(this.c.x,this.c.y),t.closePath(),t.stroke()},t.exports={Triangle:x,triangulate:function(t){if(t.length<3)return[];t.sort(m);for(var n=t.length-1,e=t[n].x,a=t[0].x,r=t[n].y,o=r;n--;)t[n].y<r&&(r=t[n].y),t[n].y>o&&(o=t[n].y);var i,u,s,h=a-e,c=o-r,l=c<h?h:c,f=.5*(a+e),d=.5*(o+r),g=[new x({x:f-20*l,y:d-l,__sentinel:!0},{x:f,y:d+20*l,__sentinel:!0},{x:f+20*l,y:d-l,__sentinel:!0})],y=[],p=[];for(n=t.length;n--;){for(p.length=0,i=g.length;i--;)0<(h=t[n].x-g[i].x)&&h*h>g[i].r?(y.push(g[i]),g.splice(i,1)):h*h+(c=t[n].y-g[i].y)*c>g[i].r||(p.push(g[i].a,g[i].b,g[i].b,g[i].c,g[i].c,g[i].a),g.splice(i,1));for(v(p),i=p.length;i;)s=p[--i],u=p[--i],g.push(new x(u,s,t[n]))}for(Array.prototype.push.apply(y,g),n=y.length;n--;)(y[n].a.__sentinel||y[n].b.__sentinel||y[n].c.__sentinel)&&y.splice(n,1);return y}}}),l=(c.Triangle,c.triangulate),f=a(function(t,n){function p(t){if(!(this instanceof p))return new p(t);var r=t.width,n=t.height,e=[[-1,0,1],[-2,0,2],[-1,0,1]],a=[[-1,-2,-1],[0,0,0],[1,2,1]],o=[],i=[];function u(a){return function(t,n,e){return a[4*(r*n+t)+(e=e||0)]}}var s,h,c=u(t.data);for(h=0;h<n;h++)for(s=0;s<r;s++){var l=(c(s,h,0)+c(s,h,1)+c(s,h,2))/3;i.push(l,l,l,255)}for(c=u(i),h=0;h<n;h++)for(s=0;s<r;s++){var f=e[0][0]*c(s-1,h-1)+e[0][1]*c(s,h-1)+e[0][2]*c(s+1,h-1)+e[1][0]*c(s-1,h)+e[1][1]*c(s,h)+e[1][2]*c(s+1,h)+e[2][0]*c(s-1,h+1)+e[2][1]*c(s,h+1)+e[2][2]*c(s+1,h+1),d=a[0][0]*c(s-1,h-1)+a[0][1]*c(s,h-1)+a[0][2]*c(s+1,h-1)+a[1][0]*c(s-1,h)+a[1][1]*c(s,h)+a[1][2]*c(s+1,h)+a[2][0]*c(s-1,h+1)+a[2][1]*c(s,h+1)+a[2][2]*c(s+1,h+1),g=Math.sqrt(f*f+d*d)>>>0;o.push(g,g,g,255)}var y=o;return"function"==typeof Uint8ClampedArray&&(y=new Uint8ClampedArray(o)),y.toImageData=function(){return p.toImageData(y,r,n)},y}function o(t,n,e){return{width:n,height:e,data:t}}p.toImageData=function(t,n,e){if("function"==typeof ImageData&&"[object Uint16Array]"===Object.prototype.toString.call(t))return new ImageData(t,n,e);if("object"!=typeof window||"object"!=typeof window.document)return new o(t,n,e);var a=document.createElement("canvas");if("function"!=typeof a.getContext)return new o(t,n,e);var r=a.getContext("2d").createImageData(n,e);return r.data.set(t),r},t.exports&&(n=t.exports=p),n.Sobel=p});f.Sobel;function d(t){return t&&"number"==typeof t.width&&"number"==typeof t.height&&t.data&&"number"==typeof t.data.length&&"object"==typeof t.data}function g(n){if(d(n)){if("undefined"==typeof Uint8ClampedArray){if("undefined"==typeof window)throw new Error("Can't copy imageData in webworker without Uint8ClampedArray support.");return y(n)}var e,t=new Uint8ClampedArray(n.data);if("undefined"==typeof ImageData)return{width:n.width,height:n.height,data:t};try{e=new ImageData(t,n.width,n.height)}catch(t){if("undefined"==typeof window)throw new Error("Can't copy imageData in webworker without proper ImageData() support.");e=y(n)}return e}throw new Error("Given imageData object is not useable.")}function y(t){var n=new u(t.width,t.height).getContext("2d");return n.putImageData(t,0,0),n.getImageData(0,0,t.width,t.height)}var G=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],V=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function q(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}function D(t,n,e){var a=t+"|"+n;e[a]||(e[a]={x:t,y:n}),a=null}function k(t){return t.forEach(function(t){var n,e,a,r,o;t.boundingBox=(n=[t.a,t.b,t.c],r=e=1/0,o=a=-1/0,n.forEach(function(t){t.x<e&&(e=t.x),t.y<r&&(r=t.y),t.x>a&&(a=t.x),t.y>o&&(o=t.y)}),{x:e,y:r,width:a-e,height:o-r})}),t.filter(function(t){return 0<t.boundingBox.width&&0<t.boundingBox.height})}function _(t,n,e){var a=(0|o(t.x,1,n.width-2))+(0|o(t.y,1,n.height-2))*n.width<<2;a>=n.data.length&&(a=n.data.length-5);var r=n.data[a+3]/255;return e&&0==r?e:{r:n.data[a],g:n.data[a+1],b:n.data[a+2],a:r}}function E(t){return{x:.33333*(t.a.x+t.b.x+t.c.x),y:.33333*(t.a.y+t.b.y+t.c.y)}}function I(t){return 0===t.a}function S(t){var n=function(t){if("string"==typeof t){var n=[0,0,0,0];return"#"===t[0]&&(t.length<7&&(t="#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+(4<t.length?t[4]+t[4]:"")),n=[parseInt(t.substr(1,2),16),parseInt(t.substr(3,2),16),parseInt(t.substr(5,2),16),7<t.length?parseInt(t.substr(7,2),16)/255:1]),0===t.indexOf("rgb")&&(t.includes("rgba")||(t+=",1"),n=t.match(/[\.\d]+/g).map(function(t){return+t})),n}}(t);return n?{r:n[0],g:n[1],b:n[2],a:n[3]}:void 0}function T(t,e,n){function a(t,n){var e=I(t)&&s;return n&&!e?n:e?s:t}var r=n.fill,o=n.stroke,i=n.strokeWidth,u=n.lineJoin,s=n.transparentColor,h=!!r&&S(r),c=!!o&&S(o);return t.forEach(function(t){var n=_(E(t),e);r&&(t.fill=a(n,h)),o&&(t.strokeColor=a(n,c),t.strokeWidth=i,t.lineJoin=u)}),t}function W(t){var n=[t.r,t.g,t.b].map(function(t){return(t/=255)<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)});return.2126*n[0]+.7152*n[1]+.0722*n[2]}function M(t,p,x){return t.forEach(function(a){var r={};"abc".split("").forEach(function(t){var n=_(a[t],p,x.transparentColor);r[t]={key:t,color:n,x:a[t].x,y:a[t].y},r[t].luminance=W(r[t].color);var e="abc".replace(t,"").split("");r[t].median={x:(a[e[0]].x+a[e[1]].x)/2,y:(a[e[0]].y+a[e[1]].y)/2},r[t].medianColor=_(r[t].median,p,x.transparentColor),r[t].medianLuminance=W(r[t].medianColor)});for(var t,n,e,o,i=[r.a,r.b,r.c].sort(function(t,n){return Math.abs(t.luminance-t.medianLuminance)-Math.abs(n.luminance-n.medianLuminance)}),u=i[0],s=i[0],h=u.median,c=[s],l=(t=s,e=(n=h).x-t.x,o=n.y-t.y,Math.sqrt(e*e+o*o)),f=1,d=x.gradientStops-2;f<d;f++){var g=f*(l/x.gradientStops)/l,y={x:s.x+g*(h.x-s.x),y:s.y+g*(h.y-s.y)};c.push(y)}c.push(h),a.gradient={x1:u.x,y1:u.y,x2:u.median.x,y2:u.median.y,colors:c.map(function(t){return _(t,p,x.transparentColor)})},x.stroke&&(a.strokeWidth=x.strokeWidth,a.lineJoin=x.lineJoin),r=null}),t}function P(t,n){if(d(t)){var e={width:t.width,height:t.height},a=g(t),r=g(t),o=function(t){for(var n,e=t.data.length,a=0;a<e;a+=4)n=.34*t.data[a]+.5*t.data[a+1]+.16*t.data[a+2],t.data[a]=n,t.data[a+1]=n,t.data[a+2]=n;return t}(function(t,n,e,a){var r,o,i,u,s,h,c,l,f,d,g,y,p,x,m,v,w,b,C,D,k,_,E,I,S=t.data,T=a+a+1,W=n-1,M=e-1,P=a+1,J=P*(P+1)/2,L=new q,B=L;for(i=1;i<T;i++)if(B=B.next=new q,i==P)var j=B;B.next=L;var U=null,A=null;c=h=0;var O=G[a],N=V[a];for(o=0;o<e;o++){for(v=w=b=C=l=f=d=g=0,y=P*(D=S[h]),p=P*(k=S[h+1]),x=P*(_=S[h+2]),m=P*(E=S[h+3]),l+=J*D,f+=J*k,d+=J*_,g+=J*E,B=L,i=0;i<P;i++)B.r=D,B.g=k,B.b=_,B.a=E,B=B.next;for(i=1;i<P;i++)u=h+((W<i?W:i)<<2),l+=(B.r=D=S[u])*(I=P-i),f+=(B.g=k=S[u+1])*I,d+=(B.b=_=S[u+2])*I,g+=(B.a=E=S[u+3])*I,v+=D,w+=k,b+=_,C+=E,B=B.next;for(U=L,A=j,r=0;r<n;r++)S[h+3]=E=g*O>>N,0!=E?(E=255/E,S[h]=(l*O>>N)*E,S[h+1]=(f*O>>N)*E,S[h+2]=(d*O>>N)*E):S[h]=S[h+1]=S[h+2]=0,l-=y,f-=p,d-=x,g-=m,y-=U.r,p-=U.g,x-=U.b,m-=U.a,u=c+((u=r+a+1)<W?u:W)<<2,l+=v+=U.r=S[u],f+=w+=U.g=S[u+1],d+=b+=U.b=S[u+2],g+=C+=U.a=S[u+3],U=U.next,y+=D=A.r,p+=k=A.g,x+=_=A.b,m+=E=A.a,v-=D,w-=k,b-=_,C-=E,A=A.next,h+=4;c+=n}for(r=0;r<n;r++){for(w=b=C=v=f=d=g=l=0,y=P*(D=S[h=r<<2]),p=P*(k=S[h+1]),x=P*(_=S[h+2]),m=P*(E=S[h+3]),l+=J*D,f+=J*k,d+=J*_,g+=J*E,B=L,i=0;i<P;i++)B.r=D,B.g=k,B.b=_,B.a=E,B=B.next;for(s=n,i=1;i<=a;i++)h=s+r<<2,l+=(B.r=D=S[h])*(I=P-i),f+=(B.g=k=S[h+1])*I,d+=(B.b=_=S[h+2])*I,g+=(B.a=E=S[h+3])*I,v+=D,w+=k,b+=_,C+=E,B=B.next,i<M&&(s+=n);for(h=r,U=L,A=j,o=0;o<e;o++)S[(u=h<<2)+3]=E=g*O>>N,0<E?(E=255/E,S[u]=(l*O>>N)*E,S[u+1]=(f*O>>N)*E,S[u+2]=(d*O>>N)*E):S[u]=S[u+1]=S[u+2]=0,l-=y,f-=p,d-=x,g-=m,y-=U.r,p-=U.g,x-=U.b,m-=U.a,u=r+((u=o+P)<M?u:M)*n<<2,l+=v+=U.r=S[u],f+=w+=U.g=S[u+1],d+=b+=U.b=S[u+2],g+=C+=U.a=S[u+3],U=U.next,y+=D=A.r,p+=k=A.g,x+=_=A.b,m+=E=A.a,v-=D,w-=k,b-=_,C-=E,A=A.next,h+=n}return t}(a,e.width,e.height,n.blur)),i=function(t,n,e,a,r){var o={},i=Math.max(~~(n*(1-e)),5),u=Math.round(Math.sqrt(i)),s=~~(a/u),h=~~(r/Math.round(Math.ceil(i/u))),c=0,l=0,f=0;for(f=0;f<r;f+=h)for(l=++c%2==0?~~(s/2):0;l<a;l+=s)l<a&&f<r&&D(~~(l+Math.cos(f)*h),~~(f+Math.sin(l)*s),o);D(0,0,o),D(a-1,0,o),D(a-1,r-1,o),D(0,r-1,o);var d=n-Object.keys(o).length,g=t.length,y=~~(g/d);if(0<n&&0<y){var p=0;for(p=0;p<g;p+=y)D(t[p].x,t[p].y,o)}return t=null,Object.keys(o).map(function(t){return o[t]})}(function(t,n){var e,a,r,o,i,u,s,h,c,l=t.width,f=t.height,d=t.data,g=[];for(a=0;a<f;a+=2)for(e=0;e<l;e+=2){for(h=c=0,r=-1;r<=1;r++)if(s=(u=a+r)*l,0<=u&&u<f)for(o=-1;o<=1;o++)0<=(i=e+o)&&i<l&&(h+=d[i+s<<2],c++);c&&(h/=c),n<h&&g.push({x:e,y:a})}return g}(f(o).toImageData(),n.threshold),n.vertexCount,n.accuracy,e.width,e.height),u=l(i);return u=k(u),n.transparentColor||(s=r,u=u.filter(function(t){return!I(_(E(t),s))})),u=(!0===n.fill&&!0===n.gradients?M:T)(u,r,n)}throw new Error("Can't work with the imageData provided. It seems to be corrupt.");var s}return function(a){a=p(a);var r,i,u=!1,s=!1,h=new Worker(URL.createObjectURL(new Blob(['function createCommonjsModule(t,a){return t(a={exports:{}},a.exports),a.exports}var delaunay=createCommonjsModule(function(t){function m(t,a,e){this.a=t,this.b=a,this.c=e;var n,r,o,i,s=a.x-t.x,u=a.y-t.y,h=e.x-t.x,c=e.y-t.y,l=s*(t.x+a.x)+u*(t.y+a.y),d=h*(t.x+e.x)+c*(t.y+e.y),g=2*(s*(e.y-a.y)-u*(e.x-a.x));Math.abs(g)<1e-6?(n=Math.min(t.x,a.x,e.x),r=Math.min(t.y,a.y,e.y),o=.5*(Math.max(t.x,a.x,e.x)-n),i=.5*(Math.max(t.y,a.y,e.y)-r),this.x=n+o,this.y=r+i):(this.x=(c*l-u*d)/g,this.y=(s*d-h*l)/g,o=this.x-t.x,i=this.y-t.y),this.r=o*o+i*i}function x(t,a){return a.x-t.x}function v(t){var a,e,n,r,o,i=t.length;t:for(;i;)for(e=t[--i],a=t[--i],n=i;n;)if(o=t[--n],a===(r=t[--n])&&e===o||a===o&&e===r){t.splice(i,2),t.splice(n,2),i-=2;continue t}}m.prototype.draw=function(t){t.beginPath(),t.moveTo(this.a.x,this.a.y),t.lineTo(this.b.x,this.b.y),t.lineTo(this.c.x,this.c.y),t.closePath(),t.stroke()},t.exports={Triangle:m,triangulate:function(t){if(t.length<3)return[];t.sort(x);for(var a=t.length-1,e=t[a].x,n=t[0].x,r=t[a].y,o=r;a--;)t[a].y<r&&(r=t[a].y),t[a].y>o&&(o=t[a].y);var i,s,u,h=n-e,c=o-r,l=c<h?h:c,d=.5*(n+e),g=.5*(o+r),f=[new m({x:d-20*l,y:g-l,__sentinel:!0},{x:d,y:g+20*l,__sentinel:!0},{x:d+20*l,y:g-l,__sentinel:!0})],y=[],p=[];for(a=t.length;a--;){for(p.length=0,i=f.length;i--;)0<(h=t[a].x-f[i].x)&&h*h>f[i].r?(y.push(f[i]),f.splice(i,1)):h*h+(c=t[a].y-f[i].y)*c>f[i].r||(p.push(f[i].a,f[i].b,f[i].b,f[i].c,f[i].c,f[i].a),f.splice(i,1));for(v(p),i=p.length;i;)u=p[--i],s=p[--i],f.push(new m(s,u,t[a]))}for(Array.prototype.push.apply(y,f),a=y.length;a--;)(y[a].a.__sentinel||y[a].b.__sentinel||y[a].c.__sentinel)&&y.splice(a,1);return y}}}),delaunay_1=delaunay.Triangle,delaunay_2=delaunay.triangulate,sobel=createCommonjsModule(function(t,a){function p(t){if(!(this instanceof p))return new p(t);var r=t.width,a=t.height,e=[[-1,0,1],[-2,0,2],[-1,0,1]],n=[[-1,-2,-1],[0,0,0],[1,2,1]],o=[],i=[];function s(n){return function(t,a,e){return n[4*(r*a+t)+(e=e||0)]}}var u,h,c=s(t.data);for(h=0;h<a;h++)for(u=0;u<r;u++){var l=(c(u,h,0)+c(u,h,1)+c(u,h,2))/3;i.push(l,l,l,255)}for(c=s(i),h=0;h<a;h++)for(u=0;u<r;u++){var d=e[0][0]*c(u-1,h-1)+e[0][1]*c(u,h-1)+e[0][2]*c(u+1,h-1)+e[1][0]*c(u-1,h)+e[1][1]*c(u,h)+e[1][2]*c(u+1,h)+e[2][0]*c(u-1,h+1)+e[2][1]*c(u,h+1)+e[2][2]*c(u+1,h+1),g=n[0][0]*c(u-1,h-1)+n[0][1]*c(u,h-1)+n[0][2]*c(u+1,h-1)+n[1][0]*c(u-1,h)+n[1][1]*c(u,h)+n[1][2]*c(u+1,h)+n[2][0]*c(u-1,h+1)+n[2][1]*c(u,h+1)+n[2][2]*c(u+1,h+1),f=Math.sqrt(d*d+g*g)>>>0;o.push(f,f,f,255)}var y=o;return"function"==typeof Uint8ClampedArray&&(y=new Uint8ClampedArray(o)),y.toImageData=function(){return p.toImageData(y,r,a)},y}function o(t,a,e){return{width:a,height:e,data:t}}p.toImageData=function(t,a,e){if("function"==typeof ImageData&&"[object Uint16Array]"===Object.prototype.toString.call(t))return new ImageData(t,a,e);if("object"!=typeof window||"object"!=typeof window.document)return new o(t,a,e);var n=document.createElement("canvas");if("function"!=typeof n.getContext)return new o(t,a,e);var r=n.getContext("2d").createImageData(a,e);return r.data.set(t),r},t.exports&&(a=t.exports=p),a.Sobel=p}),sobel_1=sobel.Sobel;function isImageData(t){return t&&"number"==typeof t.width&&"number"==typeof t.height&&t.data&&"number"==typeof t.data.length&&"object"==typeof t.data}var Canvas=function(t,a){void 0===t&&(t=300),void 0===a&&(a=150),"undefined"==typeof window?(this.canvasEl={width:t,height:a},this.ctx=null):(this.canvasEl=document.createElement("canvas"),this.canvasEl.width=t,this.canvasEl.height=a,this.ctx=this.canvasEl.getContext("2d"))},prototypeAccessors={width:{configurable:!0},height:{configurable:!0}};function copyImageData(a){if(isImageData(a)){if("undefined"==typeof Uint8ClampedArray){if("undefined"==typeof window)throw new Error("Can\'t copy imageData in webworker without Uint8ClampedArray support.");return copyImageDataWithCanvas(a)}var e,t=new Uint8ClampedArray(a.data);if("undefined"==typeof ImageData)return{width:a.width,height:a.height,data:t};try{e=new ImageData(t,a.width,a.height)}catch(t){if("undefined"==typeof window)throw new Error("Can\'t copy imageData in webworker without proper ImageData() support.");e=copyImageDataWithCanvas(a)}return e}throw new Error("Given imageData object is not useable.")}function copyImageDataWithCanvas(t){var a=new Canvas(t.width,t.height).getContext("2d");return a.putImageData(t,0,0),a.getImageData(0,0,t.width,t.height)}Canvas.prototype.getContext=function(){return this.ctx},Canvas.prototype.toDataURL=function(t,a,e){if("function"!=typeof e)return this.canvasEl.toDataURL(t,a);e(this.canvasEl.toDataURL(t,a))},prototypeAccessors.width.get=function(){return this.canvasEl.width},prototypeAccessors.width.set=function(t){this.canvasEl.width=t},prototypeAccessors.height.get=function(){return this.canvasEl.height},prototypeAccessors.height.set=function(t){this.canvasEl.height=t},Object.defineProperties(Canvas.prototype,prototypeAccessors),"undefined"!=typeof window&&(Canvas.Image=Image);var mul_table=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],shg_table=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function BlurStack(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}function stackblur(t,a,e,n,r,o){var i,s,u,h,c,l,d,g,f,y,p,m,x,v,b,w,C,D,I,E,M,P,T,B,_=t.data,k=o+o+1,A=n-1,j=r-1,S=o+1,U=S*(S+1)/2,V=new BlurStack,W=V;for(u=1;u<k;u++)if(W=W.next=new BlurStack,u==S)var O=W;W.next=V;var J=null,L=null;d=l=0;var q=mul_table[o],G=shg_table[o];for(s=0;s<r;s++){for(w=C=D=I=g=f=y=p=0,m=S*(E=_[l]),x=S*(M=_[l+1]),v=S*(P=_[l+2]),b=S*(T=_[l+3]),g+=U*E,f+=U*M,y+=U*P,p+=U*T,W=V,u=0;u<S;u++)W.r=E,W.g=M,W.b=P,W.a=T,W=W.next;for(u=1;u<S;u++)h=l+((A<u?A:u)<<2),g+=(W.r=E=_[h])*(B=S-u),f+=(W.g=M=_[h+1])*B,y+=(W.b=P=_[h+2])*B,p+=(W.a=T=_[h+3])*B,w+=E,C+=M,D+=P,I+=T,W=W.next;for(J=V,L=O,i=0;i<n;i++)_[l+3]=T=p*q>>G,0!=T?(T=255/T,_[l]=(g*q>>G)*T,_[l+1]=(f*q>>G)*T,_[l+2]=(y*q>>G)*T):_[l]=_[l+1]=_[l+2]=0,g-=m,f-=x,y-=v,p-=b,m-=J.r,x-=J.g,v-=J.b,b-=J.a,h=d+((h=i+o+1)<A?h:A)<<2,g+=w+=J.r=_[h],f+=C+=J.g=_[h+1],y+=D+=J.b=_[h+2],p+=I+=J.a=_[h+3],J=J.next,m+=E=L.r,x+=M=L.g,v+=P=L.b,b+=T=L.a,w-=E,C-=M,D-=P,I-=T,L=L.next,l+=4;d+=n}for(i=0;i<n;i++){for(C=D=I=w=f=y=p=g=0,m=S*(E=_[l=i<<2]),x=S*(M=_[l+1]),v=S*(P=_[l+2]),b=S*(T=_[l+3]),g+=U*E,f+=U*M,y+=U*P,p+=U*T,W=V,u=0;u<S;u++)W.r=E,W.g=M,W.b=P,W.a=T,W=W.next;for(c=n,u=1;u<=o;u++)l=c+i<<2,g+=(W.r=E=_[l])*(B=S-u),f+=(W.g=M=_[l+1])*B,y+=(W.b=P=_[l+2])*B,p+=(W.a=T=_[l+3])*B,w+=E,C+=M,D+=P,I+=T,W=W.next,u<j&&(c+=n);for(l=i,J=V,L=O,s=0;s<r;s++)_[(h=l<<2)+3]=T=p*q>>G,0<T?(T=255/T,_[h]=(g*q>>G)*T,_[h+1]=(f*q>>G)*T,_[h+2]=(y*q>>G)*T):_[h]=_[h+1]=_[h+2]=0,g-=m,f-=x,y-=v,p-=b,m-=J.r,x-=J.g,v-=J.b,b-=J.a,h=i+((h=s+S)<j?h:j)*n<<2,g+=w+=J.r=_[h],f+=C+=J.g=_[h+1],y+=D+=J.b=_[h+2],p+=I+=J.a=_[h+3],J=J.next,m+=E=L.r,x+=M=L.g,v+=P=L.b,b+=T=L.a,w-=E,C-=M,D-=P,I-=T,L=L.next,l+=n}return t}function greyscale(t){for(var a,e=t.data.length,n=0;n<e;n+=4)a=.34*t.data[n]+.5*t.data[n+1]+.16*t.data[n+2],t.data[n]=a,t.data[n+1]=a,t.data[n+2]=a;return t}function getEdgePoints(t,a){var e,n,r,o,i,s,u,h,c,l=t.width,d=t.height,g=t.data,f=[];for(n=0;n<d;n+=2)for(e=0;e<l;e+=2){for(h=c=0,r=-1;r<=1;r++)if(u=(s=n+r)*l,0<=s&&s<d)for(o=-1;o<=1;o++)0<=(i=e+o)&&i<l&&(h+=g[i+u<<2],c++);c&&(h/=c),a<h&&f.push({x:e,y:n})}return f}function clamp(t,a,e){return t<a?a:e<t?e:t}function addVertex(t,a,e){var n=t+"|"+a;e[n]||(e[n]={x:t,y:a}),n=null}function getVerticesFromPoints(t,a,e,n,r){var o={},i=Math.max(~~(a*(1-e)),5),s=Math.round(Math.sqrt(i)),u=~~(n/s),h=~~(r/Math.round(Math.ceil(i/s))),c=0,l=0,d=0;for(d=0;d<r;d+=h)for(l=++c%2==0?~~(u/2):0;l<n;l+=u)l<n&&d<r&&addVertex(~~(l+Math.cos(d)*h),~~(d+Math.sin(l)*u),o);addVertex(0,0,o),addVertex(n-1,0,o),addVertex(n-1,r-1,o),addVertex(0,r-1,o);var g=a-Object.keys(o).length,f=t.length,y=~~(f/g);if(0<a&&0<y){var p=0;for(p=0;p<f;p+=y)addVertex(t[p].x,t[p].y,o)}return t=null,Object.keys(o).map(function(t){return o[t]})}function getBoundingBox(t){var a=1/0,e=-1/0,n=1/0,r=-1/0;return t.forEach(function(t){t.x<a&&(a=t.x),t.y<n&&(n=t.y),t.x>e&&(e=t.x),t.y>r&&(r=t.y)}),{x:a,y:n,width:e-a,height:r-n}}function addBoundingBoxesToPolygons(t,a,e){return t.forEach(function(t){t.boundingBox=getBoundingBox([t.a,t.b,t.c])}),t.filter(function(t){return 0<t.boundingBox.width&&0<t.boundingBox.height})}function getColorByPos(t,a,e){var n=(0|clamp(t.x,1,a.width-2))+(0|clamp(t.y,1,a.height-2))*a.width<<2;n>=a.data.length&&(n=a.data.length-5);var r=a.data[n+3]/255;return e&&0==r?e:{r:a.data[n],g:a.data[n+1],b:a.data[n+2],a:r}}function polygonCenter(t){return{x:.33333*(t.a.x+t.b.x+t.c.x),y:.33333*(t.a.y+t.b.y+t.c.y)}}function isTransparent(t){return 0===t.a}function strToColorArr(t){if("string"==typeof t){var a=[0,0,0,0];return"#"===t[0]&&(t.length<7&&(t="#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+(4<t.length?t[4]+t[4]:"")),a=[parseInt(t.substr(1,2),16),parseInt(t.substr(3,2),16),parseInt(t.substr(5,2),16),7<t.length?parseInt(t.substr(7,2),16)/255:1]),0===t.indexOf("rgb")&&(t.includes("rgba")||(t+=",1"),a=t.match(/[\\.\\d]+/g).map(function(t){return+t})),a}}function strToColor(t){var a=strToColorArr(t);return a?{r:a[0],g:a[1],b:a[2],a:a[3]}:void 0}function addColorToPolygons(t,e,a){function n(t,a){var e=isTransparent(t)&&u;return a&&!e?a:e?u:t}var r=a.fill,o=a.stroke,i=a.strokeWidth,s=a.lineJoin,u=a.transparentColor,h=!!r&&strToColor(r),c=!!o&&strToColor(o);return t.forEach(function(t){var a=getColorByPos(polygonCenter(t),e);r&&(t.fill=n(a,h)),o&&(t.strokeColor=n(a,c),t.strokeWidth=i,t.lineJoin=s)}),t}function luminance(t){var a=[t.r,t.g,t.b].map(function(t){return(t/=255)<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)});return.2126*a[0]+.7152*a[1]+.0722*a[2]}function distance(t,a){var e=a.x-t.x,n=a.y-t.y;return Math.sqrt(e*e+n*n)}function addGradientsToPolygons(t,d,g){return t.forEach(function(n){var r={};"abc".split("").forEach(function(t){var a=getColorByPos(n[t],d,g.transparentColor);r[t]={key:t,color:a,x:n[t].x,y:n[t].y},r[t].luminance=luminance(r[t].color);var e="abc".replace(t,"").split("");r[t].median={x:(n[e[0]].x+n[e[1]].x)/2,y:(n[e[0]].y+n[e[1]].y)/2},r[t].medianColor=getColorByPos(r[t].median,d,g.transparentColor),r[t].medianLuminance=luminance(r[t].medianColor)});for(var t=[r.a,r.b,r.c].sort(function(t,a){return Math.abs(t.luminance-t.medianLuminance)-Math.abs(a.luminance-a.medianLuminance)}),a=t[0],e=t[0],o=a.median,i=[e],s=distance(e,o),u=1,h=g.gradientStops-2;u<h;u++){var c=u*(s/g.gradientStops)/s,l={x:e.x+c*(o.x-e.x),y:e.y+c*(o.y-e.y)};i.push(l)}i.push(o),n.gradient={x1:a.x,y1:a.y,x2:a.median.x,y2:a.median.y,colors:i.map(function(t){return getColorByPos(t,d,g.transparentColor)})},g.stroke&&(n.strokeWidth=g.strokeWidth,n.lineJoin=g.lineJoin),r=null}),t}function filterTransparentPolygons(t,a){return t.filter(function(t){return!isTransparent(getColorByPos(polygonCenter(t),a))})}function imageDataToPolygons(t,a){if(isImageData(t)){var e={width:t.width,height:t.height},n=copyImageData(t),r=copyImageData(t),o=greyscale(stackblur(n,0,0,e.width,e.height,a.blur)),i=getVerticesFromPoints(getEdgePoints(sobel(o).toImageData(),a.threshold),a.vertexCount,a.accuracy,e.width,e.height),s=delaunay_2(i);return s=addBoundingBoxesToPolygons(s),a.transparentColor||(s=filterTransparentPolygons(s,r)),s=(!0===a.fill&&!0===a.gradients?addGradientsToPolygons:addColorToPolygons)(s,r,a)}throw new Error("Can\'t work with the imageData provided. It seems to be corrupt.")}onmessage=function(t){if(t.data.imageData&&t.data.params)try{var a=t.data.imageData;void 0===a.width&&"number"==typeof t.data.imageDataWidth&&(a.width=t.data.imageDataWidth),void 0===a.height&&"number"==typeof t.data.imageDataHeight&&(a.height=t.data.imageDataHeight);var e=imageDataToPolygons(t.data.imageData,t.data.params);self.postMessage({polygonJSONStr:JSON.stringify(e)})}catch(t){self.postMessage({err:t.message||t})}else t.data.imageData?self.postMessage({err:"Parameters are missing."}):self.postMessage({err:"ImageData is missing."});self.close()};'],{type:"text/javascript"}))),n={getParams:function(){return a},getInput:c,getOutput:l},e={fromImage:function(t){return f(x,t)},fromImageSync:function(t){return f(x,t,!0)},fromImageData:function(t){return f(function(t){return t},t)},fromImageDataSync:function(t){return f(function(t){return t},t,!0)}},o={toData:function(t){return d(function(t){return t},t)},toDataSync:function(t){return d(function(t){return t},t,!0)},toDataURL:function(t){return d(w,t)},toDataURLSync:function(t){return d(w,t,!0)},toImageData:function(t){return d(v,t)},toImageDataSync:function(t){return d(v,t,!0)},toSVG:function(t){return d(C,t)},toSVGSync:function(t){return d(C,t,!0)}};function c(){var t=m({},n);return r||m(t,e),t}function l(){var t=m({},n);return i||m(t,o),t}function f(e,a,t){return u=!!t,r=function(){return u?e(a):new Promise(function(t,n){try{t(e(a))}catch(t){n(t)}})},(g()?y:l)()}function d(r,o,t){return s=!!t,i=function(e,a){return s?r(e,a,o):new Promise(function(t,n){try{t(r(e,a,o))}catch(t){n(t)}})},(g()?y:c)()}function g(){return r&&i}function y(){if(u&&s){var t=r(a),n=P(t,a);return i(n,t)}return new Promise(function(n,t){var o,e;new Promise(function(t,n){if(u)try{t(r(e))}catch(t){n(t)}else r(e).then(t,n)}).then(function(t){return n=o=t,r=a,new Promise(function(e,a){h.addEventListener("message",function(t){if(t.data&&t.data.polygonJSONStr){var n=JSON.parse(t.data.polygonJSONStr);e(n)}else t.data&&t.data.err?a(t.data.err):a(t)}),h.postMessage({params:r,imageData:n,imageDataWidth:n.width,imageDataHeight:n.height})});var n,r},t).then(function(t){return e=t,a=o,new Promise(function(t,n){if(s)try{t(i(e,a))}catch(t){n(t)}else i(e,a).then(t,n)});var e,a},t).then(function(t){n(t)},t)})}return c()}});