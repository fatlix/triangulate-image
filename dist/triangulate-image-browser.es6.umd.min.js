!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).triangulate=e()}(this,function(){"use strict";var t=(t,e,n)=>t<e?e:t>n?n:t;class e{constructor(t=300,e=150){"undefined"==typeof window?(this.canvasEl={width:t,height:e},this.ctx=null):(this.canvasEl=document.createElement("canvas"),this.canvasEl.width=t,this.canvasEl.height=e,this.ctx=this.canvasEl.getContext("2d"))}getContext(){return this.ctx}toDataURL(t,e,n){if("function"!=typeof n)return this.canvasEl.toDataURL(t,e);n(this.canvasEl.toDataURL(t,e))}get width(){return this.canvasEl.width}set width(t){this.canvasEl.width=t}get height(){return this.canvasEl.height}set height(t){this.canvasEl.height=t}}"undefined"!=typeof window&&(e.Image=Image);var n=(t,n,a,r)=>{const o=!(!n||!n.backgroundColor)&&n.backgroundColor,i=new e(t.width*a,t.height*a,r),s=i.getContext("2d");return o&&(s.fillStyle=o,s.fillRect(0,0,t.width*a,t.height*a),s.fillStyle="transparent"),{canvas:i,ctx:s}},a=.7,r=4,o=!0,i=!0,s=.5,h="miter",l=700,d=50,c=!1;let g=["miter","round","bevel"];var u=e=>("object"!=typeof(e=(t=>{let e=!1;if(void 0!==t)try{e=JSON.parse(JSON.stringify(t))}catch(t){}return e})(e))&&(e={}),"number"!=typeof e.accuracy||isNaN(e.accuracy)?e.accuracy=a:e.accuracy=t(e.accuracy,0,1),("number"!=typeof e.blur||isNaN(e.blur))&&(e.blur=r),e.blur<=0&&(e.blur=1),"string"!=typeof e.fill&&"boolean"!=typeof e.fill&&(e.fill=o),"string"!=typeof e.stroke&&"boolean"!=typeof e.stroke&&(e.stroke=i),("number"!=typeof e.strokeWidth||isNaN(e.strokeWidth))&&(e.strokeWidth=s),"number"!=typeof e.threshold||isNaN(e.threshold)?e.threshold=d:e.threshold=t(e.threshold,1,100),"string"==typeof e.lineJoin&&-1!==g.indexOf(e.lineJoin)||(e.lineJoin=h),e.gradients&&e.fill?e.gradients=!0:e.gradients=!1,e.gradients&&(("number"!=typeof e.gradientStops||isNaN(e.gradientStops)||e.gradientStops<2)&&(e.gradientStops=2),e.gradientStops=Math.round(e.gradientStops)),("number"!=typeof e.vertexCount||isNaN(e.vertexCount))&&(e.vertexCount=l),e.vertexCount<=0&&(e.vertexCount=1),"string"!=typeof e.transparentColor&&"boolean"!=typeof e.transparentColor&&(e.transparentColor=c),!0===typeof e.transparentColor&&(e.transparentColor=!1),"string"==typeof e.transparentColor&&(e.transparentColor=(t=>{const e=n({width:1,height:1},{},1,!0).ctx;e.fillStyle=t,e.fillRect(0,0,1,1);const a=e.getImageData(0,0,1,1).data;return{r:a[0],g:a[1],b:a[2],a:a[3]/255}})(e.transparentColor)),e),f=t=>{if(t instanceof HTMLImageElement){if(!t.naturalWidth||!t.naturalHeight||!1===t.complete)throw new Error("This this image hasn't finished loading: "+t.src);const n=new e(t.naturalWidth,t.naturalHeight),a=n.getContext("2d");a.drawImage(t,0,0,n.width,n.height);const r=a.getImageData(0,0,n.width,n.height);return r.data&&r.data.length&&(void 0===r.width&&(r.width=t.naturalWidth),void 0===r.height&&(r.height=t.naturalHeight)),r}throw new Error("This object does not seem to be an image.")};const y=Object.assign;var p=t=>{const e=y({a:1},t);return`rgba(${e.r}, ${e.g}, ${e.b}, ${e.a})`},x=(t,e,n,a)=>(a=a||1,e.forEach(function(e,n){if(t.beginPath(),t.moveTo(e.a.x*a,e.a.y*a),t.lineTo(e.b.x*a,e.b.y*a),t.lineTo(e.c.x*a,e.c.y*a),t.lineTo(e.a.x*a,e.a.y*a),e.gradient){const n=t.createLinearGradient(e.gradient.x1*a,e.gradient.y1*a,e.gradient.x2*a,e.gradient.y2*a),r=e.gradient.colors.length-1;e.gradient.colors.forEach((t,e)=>{const a=p(t);console.log(t),n.addColorStop(e/r,a)}),t.fillStyle=n,t.fill(),e.strokeWidth>0&&(t.strokeStyle=n,t.lineWidth=e.strokeWidth*a,t.lineJoin=e.lineJoin,t.stroke())}else e.fill&&(t.fillStyle=p(e.fill),t.fill()),e.strokeColor&&(t.strokeStyle=p(e.strokeColor),t.lineWidth=e.strokeWidth*a,t.lineJoin=e.lineJoin,t.stroke());t.closePath()}),t),m=(t,e,a)=>{const r=a&&a.dpr?a.dpr:1,o=n(e,a,r,!0).ctx;return x(o,t,0,r),o.getImageData(0,0,e.width*r,e.height*r)},b=(t,e,a)=>{const r=a&&a.dpr?a.dpr:1,o=n(e,a,r);return x(o.ctx,t,0,r),o.canvas.toDataURL()};function w(t){const e=t.toString(16);return 1==e.length?"0"+e:e}function v({r:t,g:e,b:n}){return"#"+w(t)+w(e)+w(n)}var C=(t,e)=>{let n="";t.length&&t[0].gradient&&(n="<defs>");let a="";return t.forEach(function(t,e){const{a:r,b:o,c:i}=t;if(a+=`<polygon points="${r.x},${r.y} ${o.x},${o.y} ${i.x},${i.y}"`,t.gradient){const r=t.boundingBox,o=((t.gradient.x1-r.x)/r.width*100).toFixed(3),i=((t.gradient.y1-r.y)/r.height*100).toFixed(3),s=((t.gradient.x2-r.x)/r.width*100).toFixed(3),h=((t.gradient.y2-r.y)/r.height*100).toFixed(3);n+=`\n\t<linearGradient id="gradient-${e}" x1="${o}%" y1="${i}%" x2="${s}%" y2="${h}%">`;const l=t.gradient.colors.length-1;t.gradient.colors.forEach((t,e)=>{const a=v(t),r=t.a<1?' stop-opacity="'+t.a+'"':"",o=(e/l*100).toFixed(3);n+=`\n\t\t\t\t\t<stop offset="${o}%" stop-color="${a}"${r}/>\n\t\t\t\t`}),n+="</linearGradient>",a+=` fill="url(#gradient-${e})"`,t.strokeWidth>0&&(a+=` stroke="url(#gradient-${e})" stroke-width="${t.strokeWidth}" stroke-linejoin="${t.lineJoin}"`)}else{if(t.fill){const e=v(t.fill),n=t.fill.a<1?` fill-opacity="${t.fill.a}"`:"";a+=` fill="${e}"${n}`}else a+=' fill="transparent"';if(t.strokeColor){const e=v(t.strokeColor),n=t.strokeColor.a<1?` stroke-opacity="${t.strokeColor.a}"`:"";a+=` stroke="${e}" stroke-width="${t.strokeWidth}" stroke-linejoin="${t.lineJoin}"${n}`}}a+="/>\n\t"}),n.length&&(n+="\n\t\t</defs>"),`<?xml version="1.0" standalone="yes"?>\n<svg width="${e.width}" height="${e.height}" xmlns="http://www.w3.org/2000/svg" version="1.1" >\n\t${n}\n\t${a}\n</svg>`};function D(t,e){return t(e={exports:{}},e.exports),e.exports}var _=D(function(t){function e(t,e,n){this.a=t,this.b=e,this.c=n;var a,r,o,i,s=e.x-t.x,h=e.y-t.y,l=n.x-t.x,d=n.y-t.y,c=s*(t.x+e.x)+h*(t.y+e.y),g=l*(t.x+n.x)+d*(t.y+n.y),u=2*(s*(n.y-e.y)-h*(n.x-e.x));Math.abs(u)<1e-6?(a=Math.min(t.x,e.x,n.x),r=Math.min(t.y,e.y,n.y),o=.5*(Math.max(t.x,e.x,n.x)-a),i=.5*(Math.max(t.y,e.y,n.y)-r),this.x=a+o,this.y=r+i,this.r=o*o+i*i):(this.x=(d*c-h*g)/u,this.y=(s*g-l*c)/u,o=this.x-t.x,i=this.y-t.y,this.r=o*o+i*i)}function n(t,e){return e.x-t.x}function a(t){var e,n,a,r,o,i=t.length;t:for(;i;)for(n=t[--i],e=t[--i],a=i;a;)if(o=t[--a],e===(r=t[--a])&&n===o||e===o&&n===r){t.splice(i,2),t.splice(a,2),i-=2;continue t}}e.prototype.draw=function(t){t.beginPath(),t.moveTo(this.a.x,this.a.y),t.lineTo(this.b.x,this.b.y),t.lineTo(this.c.x,this.c.y),t.closePath(),t.stroke()},t.exports={Triangle:e,triangulate:function(t){if(t.length<3)return[];t.sort(n);for(var r=t.length-1,o=t[r].x,i=t[0].x,s=t[r].y,h=s;r--;)t[r].y<s&&(s=t[r].y),t[r].y>h&&(h=t[r].y);var l,d,c,g=i-o,u=h-s,f=g>u?g:u,y=.5*(i+o),p=.5*(h+s),x=[new e({x:y-20*f,y:p-f,__sentinel:!0},{x:y,y:p+20*f,__sentinel:!0},{x:y+20*f,y:p-f,__sentinel:!0})],m=[],b=[];for(r=t.length;r--;){for(b.length=0,l=x.length;l--;)(g=t[r].x-x[l].x)>0&&g*g>x[l].r?(m.push(x[l]),x.splice(l,1)):g*g+(u=t[r].y-x[l].y)*u>x[l].r||(b.push(x[l].a,x[l].b,x[l].b,x[l].c,x[l].c,x[l].a),x.splice(l,1));for(a(b),l=b.length;l;)c=b[--l],d=b[--l],x.push(new e(d,c,t[r]))}for(Array.prototype.push.apply(m,x),r=m.length;r--;)(m[r].a.__sentinel||m[r].b.__sentinel||m[r].c.__sentinel)&&m.splice(r,1);return m}}}),E=(_.Triangle,_.triangulate),I=D(function(t,e){!function(n){function a(t){if(!(this instanceof a))return new a(t);var e=t.width,n=t.height,r=[[-1,0,1],[-2,0,2],[-1,0,1]],o=[[-1,-2,-1],[0,0,0],[1,2,1]],i=[],s=[];function h(t){return function(n,a,r){return t[4*(e*a+n)+(r=r||0)]}}var l,d,c=h(t.data);for(d=0;d<n;d++)for(l=0;l<e;l++){var g=(c(l,d,0)+c(l,d,1)+c(l,d,2))/3;s.push(g,g,g,255)}for(c=h(s),d=0;d<n;d++)for(l=0;l<e;l++){var u=r[0][0]*c(l-1,d-1)+r[0][1]*c(l,d-1)+r[0][2]*c(l+1,d-1)+r[1][0]*c(l-1,d)+r[1][1]*c(l,d)+r[1][2]*c(l+1,d)+r[2][0]*c(l-1,d+1)+r[2][1]*c(l,d+1)+r[2][2]*c(l+1,d+1),f=o[0][0]*c(l-1,d-1)+o[0][1]*c(l,d-1)+o[0][2]*c(l+1,d-1)+o[1][0]*c(l-1,d)+o[1][1]*c(l,d)+o[1][2]*c(l+1,d)+o[2][0]*c(l-1,d+1)+o[2][1]*c(l,d+1)+o[2][2]*c(l+1,d+1),y=Math.sqrt(u*u+f*f)>>>0;i.push(y,y,y,255)}var p=i;return"function"==typeof Uint8ClampedArray&&(p=new Uint8ClampedArray(i)),p.toImageData=function(){return a.toImageData(p,e,n)},p}function r(t,e,n){return{width:e,height:n,data:t}}a.toImageData=function(t,e,n){if("function"==typeof ImageData&&"[object Uint16Array]"===Object.prototype.toString.call(t))return new ImageData(t,e,n);if("object"==typeof window&&"object"==typeof window.document){var a=document.createElement("canvas");if("function"==typeof a.getContext){var o=a.getContext("2d").createImageData(e,n);return o.data.set(t),o}return new r(t,e,n)}return new r(t,e,n)},t.exports&&(e=t.exports=a),e.Sobel=a}()}),k=(I.Sobel,t=>t&&"number"==typeof t.width&&"number"==typeof t.height&&t.data&&"number"==typeof t.data.length&&"object"==typeof t.data),T=t=>{if(k(t)){if("undefined"==typeof Uint8ClampedArray){if("undefined"==typeof window)throw new Error("Can't copy imageData in webworker without Uint8ClampedArray support.");return W(t)}{const e=new Uint8ClampedArray(t.data);if("undefined"==typeof ImageData)return{width:t.width,height:t.height,data:e};{let n;try{n=new ImageData(e,t.width,t.height)}catch(e){if("undefined"==typeof window)throw new Error("Can't copy imageData in webworker without proper ImageData() support.");n=W(t)}return n}}}throw new Error("Given imageData object is not useable.")};function W(t){const n=new e(t.width,t.height).getContext("2d");return n.putImageData(t,0,0),n.getImageData(0,0,t.width,t.height)}const M=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],$=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function S(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}function P(t,e,n){let a=t+"|"+e;n[a]||(n[a]={x:t,y:e}),a=null}var J=(e,n,a)=>{let r=(0|t(e.x,1,n.width-2))+(0|t(e.y,1,n.height-2))*n.width<<2;r>=n.data.length&&(r=n.data.length-5);const o=n.data[r+3]/255;return a&&0===o?a:{r:n.data[r],g:n.data[r+1],b:n.data[r+2],a:o}},L=t=>({x:.33333*(t.a.x+t.b.x+t.c.x),y:.33333*(t.a.y+t.b.y+t.c.y)}),A=t=>0===t.a;function B(t){const e=function(t){if("string"==typeof t){let e=[0,0,0,0];return"#"===t[0]&&(t.length<7&&(t=`#${t[1]}${t[1]}${t[2]}${t[2]}${t[3]}${t[3]}${t.length>4?t[4]+t[4]:""}`),e=[parseInt(t.substr(1,2),16),parseInt(t.substr(3,2),16),parseInt(t.substr(5,2),16),t.length>7?parseInt(t.substr(7,2),16)/255:1]),0===t.indexOf("rgb")&&(t.includes("rgba")||(t+=",1"),e=t.match(/[\.\d]+/g).map(t=>+t)),e}}(t);if(e){const[t,n,a,r]=e;return{r:t,g:n,b:a,a:r}}}var j=t=>{const e=[t.r,t.g,t.b].map(t=>(t/=255)<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4));return.2126*e[0]+.7152*e[1]+.0722*e[2]},U=(t,e)=>{let n=e.x-t.x,a=e.y-t.y;return Math.sqrt(n*n+a*a)};var O,N,V,q=(t,e)=>{if(k(t)){const n={width:t.width,height:t.height},a=T(t),r=T(t),o=(t=>{const e=t.data.length;let n;for(let a=0;a<e;a+=4)n=.34*t.data[a]+.5*t.data[a+1]+.16*t.data[a+2],t.data[a]=n,t.data[a+1]=n,t.data[a+2]=n;return t})(((t,e,n,a,r,o)=>{var i,s,h,l,d,c,g,u,f,y,p,x,m,b,w,v,C,D,_,E,I,k,T,W,P=t.data,J=o+o+1,L=a-1,A=r-1,B=o+1,j=B*(B+1)/2,U=new S,O=U;for(h=1;h<J;h++)if(O=O.next=new S,h==B)var N=O;O.next=U;var V=null,q=null;g=c=0;var R=M[o],G=$[o];for(s=0;s<r;s++){for(v=C=D=_=u=f=y=p=0,x=B*(E=P[c]),m=B*(I=P[c+1]),b=B*(k=P[c+2]),w=B*(T=P[c+3]),u+=j*E,f+=j*I,y+=j*k,p+=j*T,O=U,h=0;h<B;h++)O.r=E,O.g=I,O.b=k,O.a=T,O=O.next;for(h=1;h<B;h++)l=c+((L<h?L:h)<<2),u+=(O.r=E=P[l])*(W=B-h),f+=(O.g=I=P[l+1])*W,y+=(O.b=k=P[l+2])*W,p+=(O.a=T=P[l+3])*W,v+=E,C+=I,D+=k,_+=T,O=O.next;for(V=U,q=N,i=0;i<a;i++)P[c+3]=T=p*R>>G,0!=T?(T=255/T,P[c]=(u*R>>G)*T,P[c+1]=(f*R>>G)*T,P[c+2]=(y*R>>G)*T):P[c]=P[c+1]=P[c+2]=0,u-=x,f-=m,y-=b,p-=w,x-=V.r,m-=V.g,b-=V.b,w-=V.a,l=g+((l=i+o+1)<L?l:L)<<2,u+=v+=V.r=P[l],f+=C+=V.g=P[l+1],y+=D+=V.b=P[l+2],p+=_+=V.a=P[l+3],V=V.next,x+=E=q.r,m+=I=q.g,b+=k=q.b,w+=T=q.a,v-=E,C-=I,D-=k,_-=T,q=q.next,c+=4;g+=a}for(i=0;i<a;i++){for(C=D=_=v=f=y=p=u=0,x=B*(E=P[c=i<<2]),m=B*(I=P[c+1]),b=B*(k=P[c+2]),w=B*(T=P[c+3]),u+=j*E,f+=j*I,y+=j*k,p+=j*T,O=U,h=0;h<B;h++)O.r=E,O.g=I,O.b=k,O.a=T,O=O.next;for(d=a,h=1;h<=o;h++)c=d+i<<2,u+=(O.r=E=P[c])*(W=B-h),f+=(O.g=I=P[c+1])*W,y+=(O.b=k=P[c+2])*W,p+=(O.a=T=P[c+3])*W,v+=E,C+=I,D+=k,_+=T,O=O.next,h<A&&(d+=a);for(c=i,V=U,q=N,s=0;s<r;s++)P[3+(l=c<<2)]=T=p*R>>G,T>0?(T=255/T,P[l]=(u*R>>G)*T,P[l+1]=(f*R>>G)*T,P[l+2]=(y*R>>G)*T):P[l]=P[l+1]=P[l+2]=0,u-=x,f-=m,y-=b,p-=w,x-=V.r,m-=V.g,b-=V.b,w-=V.a,l=i+((l=s+B)<A?l:A)*a<<2,u+=v+=V.r=P[l],f+=C+=V.g=P[l+1],y+=D+=V.b=P[l+2],p+=_+=V.a=P[l+3],V=V.next,x+=E=q.r,m+=I=q.g,b+=k=q.b,w+=T=q.a,v-=E,C-=I,D-=k,_-=T,q=q.next,c+=a}return t})(a,0,0,n.width,n.height,e.blur)),i=((t,e,n,a,r)=>{const o={},i=Math.max(~~(e*(1-n)),5),s=Math.round(Math.sqrt(i)),h=~~(a/s),l=~~(r/Math.round(Math.ceil(i/s)));let d=0,c=0,g=0,u=0;for(u=0;u<r;u+=l)for(g=c=++d%2==0?~~(h/2):0;g<a;g+=h)g<a&&u<r&&P(~~(g+Math.cos(u)*l),~~(u+Math.sin(g)*h),o);P(0,0,o),P(a-1,0,o),P(a-1,r-1,o),P(0,r-1,o);const f=e-Object.keys(o).length,y=t.length,p=~~(y/f);if(e>0&&p>0){let e=0;for(e=0;e<y;e+=p)P(t[e].x,t[e].y,o)}return t=null,Object.keys(o).map(t=>o[t])})(((t,e)=>{const n=t.width,a=t.height,r=t.data,o=[];var i,s,h,l,d,c,g,u,f;for(s=0;s<a;s+=2)for(i=0;i<n;i+=2){for(u=f=0,h=-1;h<=1;h++)if(g=(c=s+h)*n,c>=0&&c<a)for(l=-1;l<=1;l++)(d=i+l)>=0&&d<n&&(u+=r[d+g<<2],f++);f&&(u/=f),u>e&&o.push({x:i,y:s})}return o})(I(o).toImageData(),e.threshold),e.vertexCount,e.accuracy,n.width,n.height);let s=E(i);return s=((t,e,n)=>(t.forEach(t=>{t.boundingBox=(t=>{let e=1/0,n=-1/0,a=1/0,r=-1/0;return t.forEach(t=>{t.x<e&&(e=t.x),t.y<a&&(a=t.y),t.x>n&&(n=t.x),t.y>r&&(r=t.y)}),{x:e,y:a,width:n-e,height:r-a}})([t.a,t.b,t.c])}),t.filter(t=>t.boundingBox.width>0&&t.boundingBox.height>0)))(s),e.transparentColor||(s=((t,e)=>t.filter(t=>{const n=J(L(t),e);return!A(n)}))(s,r)),!0===e.fill&&!0===e.gradients?(N=r,e=e,(s=s).forEach(t=>{let n={};"abc".split("").forEach(a=>{const r=J(t[a],N,e.transparentColor);n[a]={key:a,color:r,x:t[a].x,y:t[a].y},n[a].luminance=j(n[a].color);const o="abc".replace(a,"").split("");n[a].median={x:(t[o[0]].x+t[o[1]].x)/2,y:(t[o[0]].y+t[o[1]].y)/2},n[a].medianColor=J(n[a].median,N,e.transparentColor),n[a].medianLuminance=j(n[a].medianColor)});const a=[n.a,n.b,n.c].sort((t,e)=>Math.abs(t.luminance-t.medianLuminance)-Math.abs(e.luminance-e.medianLuminance)),r=a[0],o=a[0],i=r.median,s=[o],h=U(o,i);for(let t=1,n=e.gradientStops-2;t<n;t++){const n=t*(h/e.gradientStops)/h,a={x:o.x+n*(i.x-o.x),y:o.y+n*(i.y-o.y)};s.push(a)}s.push(i),t.gradient={x1:r.x,y1:r.y,x2:r.median.x,y2:r.median.y,colors:s.map(t=>J(t,N,e.transparentColor))},e.stroke&&(t.strokeWidth=e.strokeWidth,t.lineJoin=e.lineJoin),n=null}),s=s):s=function(t,e,n){const{fill:a,stroke:r,strokeWidth:o,lineJoin:i,transparentColor:s}=n,h=!!a&&B(a),l=!!r&&B(r),d=(t,e)=>{const n=A(t)&&s;return e&&!n?e:n?s:t};return t.forEach(t=>{const n=J(L(t),e);a&&(t.fill=d(n,h)),r&&(t.strokeColor=d(n,l),t.strokeWidth=o,t.lineJoin=i)}),t}(s,r,e),s}throw new Error("Can't work with the imageData provided. It seems to be corrupt.")};return function(t){t=u(t);let e=!1,n=!1;const a=new Worker(URL.createObjectURL(new Blob(['function createCommonjsModule(t,e){return t(e={exports:{}},e.exports),e.exports}var delaunay=createCommonjsModule(function(t){function e(t,e,a){this.a=t,this.b=e,this.c=a;var n,r,o,i,s=e.x-t.x,l=e.y-t.y,h=a.x-t.x,d=a.y-t.y,g=s*(t.x+e.x)+l*(t.y+e.y),c=h*(t.x+a.x)+d*(t.y+a.y),u=2*(s*(a.y-e.y)-l*(a.x-e.x));Math.abs(u)<1e-6?(n=Math.min(t.x,e.x,a.x),r=Math.min(t.y,e.y,a.y),o=.5*(Math.max(t.x,e.x,a.x)-n),i=.5*(Math.max(t.y,e.y,a.y)-r),this.x=n+o,this.y=r+i,this.r=o*o+i*i):(this.x=(d*g-l*c)/u,this.y=(s*c-h*g)/u,o=this.x-t.x,i=this.y-t.y,this.r=o*o+i*i)}function a(t,e){return e.x-t.x}function n(t){var e,a,n,r,o,i=t.length;t:for(;i;)for(a=t[--i],e=t[--i],n=i;n;)if(o=t[--n],e===(r=t[--n])&&a===o||e===o&&a===r){t.splice(i,2),t.splice(n,2),i-=2;continue t}}e.prototype.draw=function(t){t.beginPath(),t.moveTo(this.a.x,this.a.y),t.lineTo(this.b.x,this.b.y),t.lineTo(this.c.x,this.c.y),t.closePath(),t.stroke()},t.exports={Triangle:e,triangulate:function(t){if(t.length<3)return[];t.sort(a);for(var r=t.length-1,o=t[r].x,i=t[0].x,s=t[r].y,l=s;r--;)t[r].y<s&&(s=t[r].y),t[r].y>l&&(l=t[r].y);var h,d,g,c=i-o,u=l-s,y=c>u?c:u,f=.5*(i+o),p=.5*(l+s),m=[new e({x:f-20*y,y:p-y,__sentinel:!0},{x:f,y:p+20*y,__sentinel:!0},{x:f+20*y,y:p-y,__sentinel:!0})],x=[],b=[];for(r=t.length;r--;){for(b.length=0,h=m.length;h--;)(c=t[r].x-m[h].x)>0&&c*c>m[h].r?(x.push(m[h]),m.splice(h,1)):c*c+(u=t[r].y-m[h].y)*u>m[h].r||(b.push(m[h].a,m[h].b,m[h].b,m[h].c,m[h].c,m[h].a),m.splice(h,1));for(n(b),h=b.length;h;)g=b[--h],d=b[--h],m.push(new e(d,g,t[r]))}for(Array.prototype.push.apply(x,m),r=x.length;r--;)(x[r].a.__sentinel||x[r].b.__sentinel||x[r].c.__sentinel)&&x.splice(r,1);return x}}}),delaunay_1=delaunay.Triangle,delaunay_2=delaunay.triangulate,sobel=createCommonjsModule(function(t,e){!function(a){function n(t){if(!(this instanceof n))return new n(t);var e=t.width,a=t.height,r=[[-1,0,1],[-2,0,2],[-1,0,1]],o=[[-1,-2,-1],[0,0,0],[1,2,1]],i=[],s=[];function l(t){return function(a,n,r){return t[4*(e*n+a)+(r=r||0)]}}var h,d,g=l(t.data);for(d=0;d<a;d++)for(h=0;h<e;h++){var c=(g(h,d,0)+g(h,d,1)+g(h,d,2))/3;s.push(c,c,c,255)}for(g=l(s),d=0;d<a;d++)for(h=0;h<e;h++){var u=r[0][0]*g(h-1,d-1)+r[0][1]*g(h,d-1)+r[0][2]*g(h+1,d-1)+r[1][0]*g(h-1,d)+r[1][1]*g(h,d)+r[1][2]*g(h+1,d)+r[2][0]*g(h-1,d+1)+r[2][1]*g(h,d+1)+r[2][2]*g(h+1,d+1),y=o[0][0]*g(h-1,d-1)+o[0][1]*g(h,d-1)+o[0][2]*g(h+1,d-1)+o[1][0]*g(h-1,d)+o[1][1]*g(h,d)+o[1][2]*g(h+1,d)+o[2][0]*g(h-1,d+1)+o[2][1]*g(h,d+1)+o[2][2]*g(h+1,d+1),f=Math.sqrt(u*u+y*y)>>>0;i.push(f,f,f,255)}var p=i;return"function"==typeof Uint8ClampedArray&&(p=new Uint8ClampedArray(i)),p.toImageData=function(){return n.toImageData(p,e,a)},p}function r(t,e,a){return{width:e,height:a,data:t}}n.toImageData=function(t,e,a){if("function"==typeof ImageData&&"[object Uint16Array]"===Object.prototype.toString.call(t))return new ImageData(t,e,a);if("object"==typeof window&&"object"==typeof window.document){var n=document.createElement("canvas");if("function"==typeof n.getContext){var o=n.getContext("2d").createImageData(e,a);return o.data.set(t),o}return new r(t,e,a)}return new r(t,e,a)},t.exports&&(e=t.exports=n),e.Sobel=n}()}),sobel_1=sobel.Sobel,isImageData=t=>t&&"number"==typeof t.width&&"number"==typeof t.height&&t.data&&"number"==typeof t.data.length&&"object"==typeof t.data;class Canvas{constructor(t=300,e=150){"undefined"==typeof window?(this.canvasEl={width:t,height:e},this.ctx=null):(this.canvasEl=document.createElement("canvas"),this.canvasEl.width=t,this.canvasEl.height=e,this.ctx=this.canvasEl.getContext("2d"))}getContext(){return this.ctx}toDataURL(t,e,a){if("function"!=typeof a)return this.canvasEl.toDataURL(t,e);a(this.canvasEl.toDataURL(t,e))}get width(){return this.canvasEl.width}set width(t){this.canvasEl.width=t}get height(){return this.canvasEl.height}set height(t){this.canvasEl.height=t}}"undefined"!=typeof window&&(Canvas.Image=Image);var copyImageData=t=>{if(isImageData(t)){if("undefined"==typeof Uint8ClampedArray){if("undefined"==typeof window)throw new Error("Can\'t copy imageData in webworker without Uint8ClampedArray support.");return copyImageDataWithCanvas(t)}{const e=new Uint8ClampedArray(t.data);if("undefined"==typeof ImageData)return{width:t.width,height:t.height,data:e};{let a;try{a=new ImageData(e,t.width,t.height)}catch(e){if("undefined"==typeof window)throw new Error("Can\'t copy imageData in webworker without proper ImageData() support.");a=copyImageDataWithCanvas(t)}return a}}}throw new Error("Given imageData object is not useable.")};function copyImageDataWithCanvas(t){const e=new Canvas(t.width,t.height).getContext("2d");return e.putImageData(t,0,0),e.getImageData(0,0,t.width,t.height)}const mul_table=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],shg_table=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function BlurStack(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}var stackblur=(t,e,a,n,r,o)=>{var i,s,l,h,d,g,c,u,y,f,p,m,x,b,w,v,C,D,I,E,M,P,T,B,_=t.data,k=o+o+1,j=n-1,S=r-1,A=o+1,U=A*(A+1)/2,V=new BlurStack,W=V;for(l=1;l<k;l++)if(W=W.next=new BlurStack,l==A)var $=W;W.next=V;var J=null,L=null;c=g=0;var O=mul_table[o],q=shg_table[o];for(s=0;s<r;s++){for(v=C=D=I=u=y=f=p=0,m=A*(E=_[g]),x=A*(M=_[g+1]),b=A*(P=_[g+2]),w=A*(T=_[g+3]),u+=U*E,y+=U*M,f+=U*P,p+=U*T,W=V,l=0;l<A;l++)W.r=E,W.g=M,W.b=P,W.a=T,W=W.next;for(l=1;l<A;l++)h=g+((j<l?j:l)<<2),u+=(W.r=E=_[h])*(B=A-l),y+=(W.g=M=_[h+1])*B,f+=(W.b=P=_[h+2])*B,p+=(W.a=T=_[h+3])*B,v+=E,C+=M,D+=P,I+=T,W=W.next;for(J=V,L=$,i=0;i<n;i++)_[g+3]=T=p*O>>q,0!=T?(T=255/T,_[g]=(u*O>>q)*T,_[g+1]=(y*O>>q)*T,_[g+2]=(f*O>>q)*T):_[g]=_[g+1]=_[g+2]=0,u-=m,y-=x,f-=b,p-=w,m-=J.r,x-=J.g,b-=J.b,w-=J.a,h=c+((h=i+o+1)<j?h:j)<<2,u+=v+=J.r=_[h],y+=C+=J.g=_[h+1],f+=D+=J.b=_[h+2],p+=I+=J.a=_[h+3],J=J.next,m+=E=L.r,x+=M=L.g,b+=P=L.b,w+=T=L.a,v-=E,C-=M,D-=P,I-=T,L=L.next,g+=4;c+=n}for(i=0;i<n;i++){for(C=D=I=v=y=f=p=u=0,m=A*(E=_[g=i<<2]),x=A*(M=_[g+1]),b=A*(P=_[g+2]),w=A*(T=_[g+3]),u+=U*E,y+=U*M,f+=U*P,p+=U*T,W=V,l=0;l<A;l++)W.r=E,W.g=M,W.b=P,W.a=T,W=W.next;for(d=n,l=1;l<=o;l++)g=d+i<<2,u+=(W.r=E=_[g])*(B=A-l),y+=(W.g=M=_[g+1])*B,f+=(W.b=P=_[g+2])*B,p+=(W.a=T=_[g+3])*B,v+=E,C+=M,D+=P,I+=T,W=W.next,l<S&&(d+=n);for(g=i,J=V,L=$,s=0;s<r;s++)_[(h=g<<2)+3]=T=p*O>>q,T>0?(T=255/T,_[h]=(u*O>>q)*T,_[h+1]=(y*O>>q)*T,_[h+2]=(f*O>>q)*T):_[h]=_[h+1]=_[h+2]=0,u-=m,y-=x,f-=b,p-=w,m-=J.r,x-=J.g,b-=J.b,w-=J.a,h=i+((h=s+A)<S?h:S)*n<<2,u+=v+=J.r=_[h],y+=C+=J.g=_[h+1],f+=D+=J.b=_[h+2],p+=I+=J.a=_[h+3],J=J.next,m+=E=L.r,x+=M=L.g,b+=P=L.b,w+=T=L.a,v-=E,C-=M,D-=P,I-=T,L=L.next,g+=n}return t},greyscale=t=>{const e=t.data.length;let a;for(let n=0;n<e;n+=4)a=.34*t.data[n]+.5*t.data[n+1]+.16*t.data[n+2],t.data[n]=a,t.data[n+1]=a,t.data[n+2]=a;return t},getEdgePoints=(t,e)=>{const a=t.width,n=t.height,r=t.data,o=[];var i,s,l,h,d,g,c,u,y;for(s=0;s<n;s+=2)for(i=0;i<a;i+=2){for(u=y=0,l=-1;l<=1;l++)if(c=(g=s+l)*a,g>=0&&g<n)for(h=-1;h<=1;h++)(d=i+h)>=0&&d<a&&(u+=r[d+c<<2],y++);y&&(u/=y),u>e&&o.push({x:i,y:s})}return o},clamp=(t,e,a)=>t<e?e:t>a?a:t;function addVertex(t,e,a){let n=t+"|"+e;a[n]||(a[n]={x:t,y:e}),n=null}var getVerticesFromPoints=(t,e,a,n,r)=>{const o={},i=Math.max(~~(e*(1-a)),5),s=Math.round(Math.sqrt(i)),l=~~(n/s),h=~~(r/Math.round(Math.ceil(i/s)));let d=0,g=0,c=0,u=0;for(u=0;u<r;u+=h)for(c=g=++d%2==0?~~(l/2):0;c<n;c+=l)c<n&&u<r&&addVertex(~~(c+Math.cos(u)*h),~~(u+Math.sin(c)*l),o);addVertex(0,0,o),addVertex(n-1,0,o),addVertex(n-1,r-1,o),addVertex(0,r-1,o);const y=e-Object.keys(o).length,f=t.length,p=~~(f/y);if(e>0&&p>0){let e=0;for(e=0;e<f;e+=p)addVertex(t[e].x,t[e].y,o)}return t=null,Object.keys(o).map(t=>o[t])},getBoundingBox=t=>{let e=1/0,a=-1/0,n=1/0,r=-1/0;return t.forEach(t=>{t.x<e&&(e=t.x),t.y<n&&(n=t.y),t.x>a&&(a=t.x),t.y>r&&(r=t.y)}),{x:e,y:n,width:a-e,height:r-n}},addBoundingBoxesToPolygons=(t,e,a)=>(t.forEach(t=>{t.boundingBox=getBoundingBox([t.a,t.b,t.c])}),t.filter(t=>t.boundingBox.width>0&&t.boundingBox.height>0)),getColorByPos=(t,e,a)=>{let n=(0|clamp(t.x,1,e.width-2))+(0|clamp(t.y,1,e.height-2))*e.width<<2;n>=e.data.length&&(n=e.data.length-5);const r=e.data[n+3]/255;return a&&0===r?a:{r:e.data[n],g:e.data[n+1],b:e.data[n+2],a:r}},polygonCenter=t=>({x:.33333*(t.a.x+t.b.x+t.c.x),y:.33333*(t.a.y+t.b.y+t.c.y)}),isTransparent=t=>0===t.a;function strToColorArr(t){if("string"==typeof t){let e=[0,0,0,0];return"#"===t[0]&&(t.length<7&&(t=`#${t[1]}${t[1]}${t[2]}${t[2]}${t[3]}${t[3]}${t.length>4?t[4]+t[4]:""}`),e=[parseInt(t.substr(1,2),16),parseInt(t.substr(3,2),16),parseInt(t.substr(5,2),16),t.length>7?parseInt(t.substr(7,2),16)/255:1]),0===t.indexOf("rgb")&&(t.includes("rgba")||(t+=",1"),e=t.match(/[\\.\\d]+/g).map(t=>+t)),e}}function strToColor(t){const e=strToColorArr(t);if(e){const[t,a,n,r]=e;return{r:t,g:a,b:n,a:r}}}function addColorToPolygons(t,e,a){const{fill:n,stroke:r,strokeWidth:o,lineJoin:i,transparentColor:s}=a,l=!!n&&strToColor(n),h=!!r&&strToColor(r),d=(t,e)=>{const a=isTransparent(t)&&s;return e&&!a?e:a?s:t};return t.forEach(t=>{const a=getColorByPos(polygonCenter(t),e);n&&(t.fill=d(a,l)),r&&(t.strokeColor=d(a,h),t.strokeWidth=o,t.lineJoin=i)}),t}var luminance=t=>{const e=[t.r,t.g,t.b].map(t=>(t/=255)<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4));return.2126*e[0]+.7152*e[1]+.0722*e[2]},distance=(t,e)=>{let a=e.x-t.x,n=e.y-t.y;return Math.sqrt(a*a+n*n)};function addGradientsToPolygons(t,e,a){return t.forEach(t=>{let n={};"abc".split("").forEach(r=>{const o=getColorByPos(t[r],e,a.transparentColor);n[r]={key:r,color:o,x:t[r].x,y:t[r].y},n[r].luminance=luminance(n[r].color);const i="abc".replace(r,"").split("");n[r].median={x:(t[i[0]].x+t[i[1]].x)/2,y:(t[i[0]].y+t[i[1]].y)/2},n[r].medianColor=getColorByPos(n[r].median,e,a.transparentColor),n[r].medianLuminance=luminance(n[r].medianColor)});const r=[n.a,n.b,n.c].sort((t,e)=>Math.abs(t.luminance-t.medianLuminance)-Math.abs(e.luminance-e.medianLuminance)),o=r[0],i=r[0],s=o.median,l=[i],h=distance(i,s);for(let t=1,e=a.gradientStops-2;t<e;t++){const e=t*(h/a.gradientStops)/h,n={x:i.x+e*(s.x-i.x),y:i.y+e*(s.y-i.y)};l.push(n)}l.push(s),t.gradient={x1:o.x,y1:o.y,x2:o.median.x,y2:o.median.y,colors:l.map(t=>getColorByPos(t,e,a.transparentColor))},a.stroke&&(t.strokeWidth=a.strokeWidth,t.lineJoin=a.lineJoin),n=null}),t}var filterTransparentPolygons=(t,e)=>t.filter(t=>{const a=getColorByPos(polygonCenter(t),e);return!isTransparent(a)}),imageDataToPolygons=(t,e)=>{if(isImageData(t)){const a={width:t.width,height:t.height},n=copyImageData(t),r=copyImageData(t),o=stackblur(n,0,0,a.width,a.height,e.blur),i=greyscale(o),s=sobel(i).toImageData(),l=getEdgePoints(s,e.threshold),h=getVerticesFromPoints(l,e.vertexCount,e.accuracy,a.width,a.height);let d=delaunay_2(h);return d=addBoundingBoxesToPolygons(d),e.transparentColor||(d=filterTransparentPolygons(d,r)),d=!0===e.fill&&!0===e.gradients?addGradientsToPolygons(d,r,e):addColorToPolygons(d,r,e)}throw new Error("Can\'t work with the imageData provided. It seems to be corrupt.")};onmessage=(t=>{if(t.data.imageData&&t.data.params)try{let e=t.data.imageData;void 0===e.width&&"number"==typeof t.data.imageDataWidth&&(e.width=t.data.imageDataWidth),void 0===e.height&&"number"==typeof t.data.imageDataHeight&&(e.height=t.data.imageDataHeight);const a=imageDataToPolygons(t.data.imageData,t.data.params);self.postMessage({polygonJSONStr:JSON.stringify(a)})}catch(t){self.postMessage({err:t.message||t})}else t.data.imageData?self.postMessage({err:"Parameters are missing."}):self.postMessage({err:"ImageData is missing."});self.close()});'],{type:"text/javascript"})));let r,o;const i={getParams:function(){return t},getInput:l,getOutput:d},s={fromImage:function(t){return c(f,t)},fromImageSync:function(t){return c(f,t,!0)},fromImageData:function(t){return c(t=>t,t)},fromImageDataSync:function(t){return c(t=>t,t,!0)}},h={toData:function(t){return g(t=>t,t)},toDataSync:function(t){return g(t=>t,t,!0)},toDataURL:function(t){return g(b,t)},toDataURLSync:function(t){return g(b,t,!0)},toImageData:function(t){return g(m,t)},toImageDataSync:function(t){return g(m,t,!0)},toSVG:function(t){return g(C,t)},toSVGSync:function(t){return g(C,t,!0)}};function l(){let t=y({},i);return r||y(t,s),t}function d(){let t=y({},i);return o||y(t,h),t}function c(t,n,a){return e=!!a,r=function(){return e?t(n):new Promise((e,a)=>{try{e(t(n))}catch(t){a(t)}})},p()?x():d()}function g(t,e,a){return n=!!a,o=((a,r)=>n?t(a,r,e):new Promise((n,o)=>{try{n(t(a,r,e))}catch(t){o(t)}})),p()?x():l()}function p(){return r&&o}function x(){if(e&&n){const e=r(t),n=q(e,t);return o(n,e)}return new Promise((i,s)=>{let l;new Promise((t,n)=>{if(e)try{const e=r(h);t(e)}catch(t){n(t)}else r(h).then(t,n)}).then(e=>(function(t,e){return new Promise((n,r)=>{a.addEventListener("message",t=>{if(t.data&&t.data.polygonJSONStr){const e=JSON.parse(t.data.polygonJSONStr);n(e)}else t.data&&t.data.err?r(t.data.err):r(t)}),a.postMessage({params:e,imageData:t,imageDataWidth:t.width,imageDataHeight:t.height})})})(l=e,t),s).then(t=>(t=t,l=l,new Promise((e,a)=>{if(n)try{const n=o(t,l);e(n)}catch(t){a(t)}else o(t,l).then(e,a)})),s).then(t=>{i(t)},s)});var i,s,h}return l()}});