!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).triangulate=e()}(this,function(){"use strict";function o(t,e,n){return t<e?e:n<t?n:t}var s=function(t,e){void 0===t&&(t=300),void 0===e&&(e=150),"undefined"==typeof window?(this.canvasEl={width:t,height:e},this.ctx=null):(this.canvasEl=document.createElement("canvas"),this.canvasEl.width=t,this.canvasEl.height=e,this.ctx=this.canvasEl.getContext("2d"))},t={width:{configurable:!0},height:{configurable:!0}};function i(t,e,n,r){var a=!(!e||!e.backgroundColor)&&e.backgroundColor,o=new s(t.width*n,t.height*n,r),i=o.getContext("2d");return a&&(i.fillStyle=a,i.fillRect(0,0,t.width*n,t.height*n),i.fillStyle="transparent"),{canvas:o,ctx:i}}s.prototype.getContext=function(){return this.ctx},s.prototype.toDataURL=function(t,e,n){if("function"!=typeof n)return this.canvasEl.toDataURL(t,e);n(this.canvasEl.toDataURL(t,e))},t.width.get=function(){return this.canvasEl.width},t.width.set=function(t){this.canvasEl.width=t},t.height.get=function(){return this.canvasEl.height},t.height.set=function(t){this.canvasEl.height=t},Object.defineProperties(s.prototype,t),"undefined"!=typeof window&&(s.Image=Image);var e={accuracy:.7,blur:4,fill:!0,stroke:!0,strokeWidth:.5,lineJoin:"miter",vertexCount:700,threshold:50,transparentColor:!1},n=["miter","round","bevel"];function p(t){return"object"!=typeof(t=function(t){var e=!1;if(void 0!==t)try{e=JSON.parse(JSON.stringify(t))}catch(t){}return e}(t))&&(t={}),"number"!=typeof t.accuracy||isNaN(t.accuracy)?t.accuracy=e.accuracy:t.accuracy=o(t.accuracy,0,1),"number"==typeof t.blur&&!isNaN(t.blur)||(t.blur=e.blur),t.blur<=0&&(t.blur=1),"string"!=typeof t.fill&&"boolean"!=typeof t.fill&&(t.fill=e.fill),"string"!=typeof t.stroke&&"boolean"!=typeof t.stroke&&(t.stroke=e.stroke),"number"==typeof t.strokeWidth&&!isNaN(t.strokeWidth)||(t.strokeWidth=e.strokeWidth),"number"!=typeof t.threshold||isNaN(t.threshold)?t.threshold=e.threshold:t.threshold=o(t.threshold,1,100),"string"==typeof t.lineJoin&&-1!==n.indexOf(t.lineJoin)||(t.lineJoin=e.lineJoin),t.gradients&&t.fill?t.gradients=!0:t.gradients=!1,t.gradients&&(("number"!=typeof t.gradientStops||isNaN(t.gradientStops)||t.gradientStops<2)&&(t.gradientStops=2),t.gradientStops=Math.round(t.gradientStops)),"number"==typeof t.vertexCount&&!isNaN(t.vertexCount)||(t.vertexCount=e.vertexCount),t.vertexCount<=0&&(t.vertexCount=1),"string"!=typeof t.transparentColor&&"boolean"!=typeof t.transparentColor&&(t.transparentColor=e.transparentColor),!0===typeof t.transparentColor&&(t.transparentColor=!1),"string"==typeof t.transparentColor&&(t.transparentColor=function(t){var e=i({width:1,height:1},{},1,!0).ctx;e.fillStyle=t,e.fillRect(0,0,1,1);var n=e.getImageData(0,0,1,1).data;return{r:n[0],g:n[1],b:n[2],a:n[3]/255}}(t.transparentColor)),t}function v(t){if(t instanceof HTMLImageElement){if(!t.naturalWidth||!t.naturalHeight||!1===t.complete)throw new Error("This this image hasn't finished loading: "+t.src);var e=new s(t.naturalWidth,t.naturalHeight),n=e.getContext("2d");n.drawImage(t,0,0,e.width,e.height);var r=n.getImageData(0,0,e.width,e.height);return r.data&&r.data.length&&(void 0===r.width&&(r.width=t.naturalWidth),void 0===r.height&&(r.height=t.naturalHeight)),r}throw new Error("This object does not seem to be an image.")}var c=Object.getOwnPropertySymbols,f=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable;var m=function(){try{if(!Object.assign)return;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return;for(var e={},n=0;n<10;n++)e["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(e).map(function(t){return e[t]}).join(""))return;var r={};return"abcdefghijklmnopqrst".split("").forEach(function(t){r[t]=t}),"abcdefghijklmnopqrst"!==Object.keys(Object.assign({},r)).join("")?void 0:1}catch(t){return}}()?Object.assign:function(t,e){for(var n,r,a=arguments,o=function(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}(t),i=1;i<arguments.length;i++){for(var s in n=Object(a[i]))f.call(n,s)&&(o[s]=n[s]);if(c){r=c(n);for(var u=0;u<r.length;u++)l.call(n,r[u])&&(o[r[u]]=n[r[u]])}}return o};function u(t){var e=m({a:1},t);return"rgba("+e.r+", "+e.g+", "+e.b+", "+e.a+")"}function h(n,t,e,o){return o=o||1,t.forEach(function(t,e){if(n.beginPath(),n.moveTo(t.a.x*o,t.a.y*o),n.lineTo(t.b.x*o,t.b.y*o),n.lineTo(t.c.x*o,t.c.y*o),n.lineTo(t.a.x*o,t.a.y*o),t.gradient){var r=n.createLinearGradient(t.gradient.x1*o,t.gradient.y1*o,t.gradient.x2*o,t.gradient.y2*o),a=t.gradient.colors.length-1;t.gradient.colors.forEach(function(t,e){var n=u(t);console.log(t),r.addColorStop(e/a,n)}),n.fillStyle=r,n.fill(),0<t.strokeWidth&&(n.strokeStyle=r,n.lineWidth=t.strokeWidth*o,n.lineJoin=t.lineJoin,n.stroke())}else t.fill&&(n.fillStyle=u(t.fill),n.fill()),t.strokeColor&&(n.strokeStyle=u(t.strokeColor),n.lineWidth=t.strokeWidth*o,n.lineJoin=t.lineJoin,n.stroke());n.closePath()}),n}function b(t,e,n){var r=n&&n.dpr?n.dpr:1,a=i(e,n,r,!0).ctx;return h(a,t,0,r),a.getImageData(0,0,e.width*r,e.height*r)}function x(t,e,n){var r=n&&n.dpr?n.dpr:1,a=i(e,n,r);return h(a.ctx,t,0,r),a.canvas.toDataURL()}function a(t){var e=t.toString(16);return 1==e.length?"0"+e:e}function w(t){var e=t.r,n=t.g,r=t.b;return"#"+a(e)+a(n)+a(r)}function C(t,e){var y="";t.length&&t[0].gradient&&(y="<defs>");var p="";return t.forEach(function(t,e){var n=t.a,r=t.b,a=t.c;if(p+='<polygon points="'+n.x+","+n.y+" "+r.x+","+r.y+" "+a.x+","+a.y+'"',t.gradient){var o=t.boundingBox,i=((t.gradient.x1-o.x)/o.width*100).toFixed(3),s=((t.gradient.y1-o.y)/o.height*100).toFixed(3),u=((t.gradient.x2-o.x)/o.width*100).toFixed(3),c=((t.gradient.y2-o.y)/o.height*100).toFixed(3);y+='\n\t<linearGradient id="gradient-'+e+'" x1="'+i+'%" y1="'+s+'%" x2="'+u+'%" y2="'+c+'%">';var f=t.gradient.colors.length-1;t.gradient.colors.forEach(function(t,e){var n=w(t),r=t.a<1?' stop-opacity="'+t.a+'"':"",a=(e/f*100).toFixed(3);y+='\n\t\t\t\t\t<stop offset="'+a+'%" stop-color="'+n+'"'+r+"/>\n\t\t\t\t"}),y+="</linearGradient>",p+=' fill="url(#gradient-'+e+')"',0<t.strokeWidth&&(p+=' stroke="url(#gradient-'+e+')" stroke-width="'+t.strokeWidth+'" stroke-linejoin="'+t.lineJoin+'"')}else{if(t.fill){var l=w(t.fill),h=t.fill.a<1?' fill-opacity="'+t.fill.a+'"':"";p+=' fill="'+l+'"'+h}else p+=' fill="transparent"';if(t.strokeColor){var d=w(t.strokeColor),g=t.strokeColor.a<1?' stroke-opacity="'+t.strokeColor.a+'"':"";p+=' stroke="'+d+'" stroke-width="'+t.strokeWidth+'" stroke-linejoin="'+t.lineJoin+'"'+g}}p+="/>\n\t"}),y.length&&(y+="\n\t\t</defs>"),'<?xml version="1.0" standalone="yes"?>\n<svg width="'+e.width+'" height="'+e.height+'" xmlns="http://www.w3.org/2000/svg" version="1.1" >\n\t'+y+"\n\t"+p+"\n</svg>"}var rt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function at(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}function r(t,e){return t(e={exports:{}},e.exports),e.exports}var d=r(function(t){function v(t,e,n){this.a=t,this.b=e,this.c=n;var r,a,o,i,s=e.x-t.x,u=e.y-t.y,c=n.x-t.x,f=n.y-t.y,l=s*(t.x+e.x)+u*(t.y+e.y),h=c*(t.x+n.x)+f*(t.y+n.y),d=2*(s*(n.y-e.y)-u*(n.x-e.x));Math.abs(d)<1e-6?(r=Math.min(t.x,e.x,n.x),a=Math.min(t.y,e.y,n.y),o=.5*(Math.max(t.x,e.x,n.x)-r),i=.5*(Math.max(t.y,e.y,n.y)-a),this.x=r+o,this.y=a+i):(this.x=(f*l-u*h)/d,this.y=(s*h-c*l)/d,o=this.x-t.x,i=this.y-t.y),this.r=o*o+i*i}function m(t,e){return e.x-t.x}function b(t){var e,n,r,a,o,i=t.length;t:for(;i;)for(n=t[--i],e=t[--i],r=i;r;)if(o=t[--r],e===(a=t[--r])&&n===o||e===o&&n===a){t.splice(i,2),t.splice(r,2),i-=2;continue t}}v.prototype.draw=function(t){t.beginPath(),t.moveTo(this.a.x,this.a.y),t.lineTo(this.b.x,this.b.y),t.lineTo(this.c.x,this.c.y),t.closePath(),t.stroke()},t.exports={Triangle:v,triangulate:function(t){if(t.length<3)return[];t.sort(m);for(var e=t.length-1,n=t[e].x,r=t[0].x,a=t[e].y,o=a;e--;)t[e].y<a&&(a=t[e].y),t[e].y>o&&(o=t[e].y);var i,s,u,c=r-n,f=o-a,l=f<c?c:f,h=.5*(r+n),d=.5*(o+a),g=[new v({x:h-20*l,y:d-l,__sentinel:!0},{x:h,y:d+20*l,__sentinel:!0},{x:h+20*l,y:d-l,__sentinel:!0})],y=[],p=[];for(e=t.length;e--;){for(p.length=0,i=g.length;i--;)0<(c=t[e].x-g[i].x)&&c*c>g[i].r?(y.push(g[i]),g.splice(i,1)):c*c+(f=t[e].y-g[i].y)*f>g[i].r||(p.push(g[i].a,g[i].b,g[i].b,g[i].c,g[i].c,g[i].a),g.splice(i,1));for(b(p),i=p.length;i;)u=p[--i],s=p[--i],g.push(new v(s,u,t[e]))}for(Array.prototype.push.apply(y,g),e=y.length;e--;)(y[e].a.__sentinel||y[e].b.__sentinel||y[e].c.__sentinel)&&y.splice(e,1);return y}}}),g=(d.Triangle,d.triangulate),y=r(function(t,e){function p(t){if(!(this instanceof p))return new p(t);var a=t.width,e=t.height,n=[[-1,0,1],[-2,0,2],[-1,0,1]],r=[[-1,-2,-1],[0,0,0],[1,2,1]],o=[],i=[];function s(r){return function(t,e,n){return r[4*(a*e+t)+(n=n||0)]}}var u,c,f=s(t.data);for(c=0;c<e;c++)for(u=0;u<a;u++){var l=(f(u,c,0)+f(u,c,1)+f(u,c,2))/3;i.push(l,l,l,255)}for(f=s(i),c=0;c<e;c++)for(u=0;u<a;u++){var h=n[0][0]*f(u-1,c-1)+n[0][1]*f(u,c-1)+n[0][2]*f(u+1,c-1)+n[1][0]*f(u-1,c)+n[1][1]*f(u,c)+n[1][2]*f(u+1,c)+n[2][0]*f(u-1,c+1)+n[2][1]*f(u,c+1)+n[2][2]*f(u+1,c+1),d=r[0][0]*f(u-1,c-1)+r[0][1]*f(u,c-1)+r[0][2]*f(u+1,c-1)+r[1][0]*f(u-1,c)+r[1][1]*f(u,c)+r[1][2]*f(u+1,c)+r[2][0]*f(u-1,c+1)+r[2][1]*f(u,c+1)+r[2][2]*f(u+1,c+1),g=Math.sqrt(h*h+d*d)>>>0;o.push(g,g,g,255)}var y=o;return"function"==typeof Uint8ClampedArray&&(y=new Uint8ClampedArray(o)),y.toImageData=function(){return p.toImageData(y,a,e)},y}function o(t,e,n){return{width:e,height:n,data:t}}p.toImageData=function(t,e,n){if("function"==typeof ImageData&&"[object Uint16Array]"===Object.prototype.toString.call(t))return new ImageData(t,e,n);if("object"!=typeof window||"object"!=typeof window.document)return new o(t,e,n);var r=document.createElement("canvas");if("function"!=typeof r.getContext)return new o(t,e,n);var a=r.getContext("2d").createImageData(e,n);return a.data.set(t),a},t.exports&&(e=t.exports=p),e.Sobel=p});y.Sobel;function E(t){return t&&"number"==typeof t.width&&"number"==typeof t.height&&t.data&&"number"==typeof t.data.length&&"object"==typeof t.data}function _(e){if(E(e)){if("undefined"==typeof Uint8ClampedArray){if("undefined"==typeof window)throw new Error("Can't copy imageData in webworker without Uint8ClampedArray support.");return j(e)}var n,t=new Uint8ClampedArray(e.data);if("undefined"==typeof ImageData)return{width:e.width,height:e.height,data:t};try{n=new ImageData(t,e.width,e.height)}catch(t){if("undefined"==typeof window)throw new Error("Can't copy imageData in webworker without proper ImageData() support.");n=j(e)}return n}throw new Error("Given imageData object is not useable.")}function j(t){var e=new s(t.width,t.height).getContext("2d");return e.putImageData(t,0,0),e.getImageData(0,0,t.width,t.height)}var B=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],q=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function R(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}function T(t,e,n){var r=t+"|"+e;n[r]||(n[r]={x:t,y:e}),r=null}function S(t){return t.forEach(function(t){var e,n,r,a,o;t.boundingBox=(e=[t.a,t.b,t.c],a=n=1/0,o=r=-1/0,e.forEach(function(t){t.x<n&&(n=t.x),t.y<a&&(a=t.y),t.x>r&&(r=t.x),t.y>o&&(o=t.y)}),{x:n,y:a,width:r-n,height:o-a})}),t.filter(function(t){return 0<t.boundingBox.width&&0<t.boundingBox.height})}function D(t,e,n){var r=(0|o(t.x,1,e.width-2))+(0|o(t.y,1,e.height-2))*e.width<<2;r>=e.data.length&&(r=e.data.length-5);var a=e.data[r+3]/255;return n&&0==a?n:{r:e.data[r],g:e.data[r+1],b:e.data[r+2],a:a}}function O(t){return{x:.33333*(t.a.x+t.b.x+t.c.x),y:.33333*(t.a.y+t.b.y+t.c.y)}}function k(t){return 0===t.a}function I(t){var e=function(t){if("string"==typeof t){var e=[0,0,0,0];return"#"===t[0]&&(t.length<7&&(t="#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+(4<t.length?t[4]+t[4]:"")),e=[parseInt(t.substr(1,2),16),parseInt(t.substr(3,2),16),parseInt(t.substr(5,2),16),7<t.length?parseInt(t.substr(7,2),16)/255:1]),0===t.indexOf("rgb")&&(t.includes("rgba")||(t+=",1"),e=t.match(/[\.\d]+/g).map(function(t){return+t})),e}}(t);return e?{r:e[0],g:e[1],b:e[2],a:e[3]}:void 0}function P(t,n,e){function r(t,e){var n=k(t)&&u;return e&&!n?e:n?u:t}var a=e.fill,o=e.stroke,i=e.strokeWidth,s=e.lineJoin,u=e.transparentColor,c=!!a&&I(a),f=!!o&&I(o);return t.forEach(function(t){var e=D(O(t),n);a&&(t.fill=r(e,c)),o&&(t.strokeColor=r(e,f),t.strokeWidth=i,t.lineJoin=s)}),t}function M(t){var e=[t.r,t.g,t.b].map(function(t){return(t/=255)<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)});return.2126*e[0]+.7152*e[1]+.0722*e[2]}function A(t,p,v){return t.forEach(function(r){var a={};"abc".split("").forEach(function(t){var e=D(r[t],p,v.transparentColor);a[t]={key:t,color:e,x:r[t].x,y:r[t].y},a[t].luminance=M(a[t].color);var n="abc".replace(t,"").split("");a[t].median={x:(r[n[0]].x+r[n[1]].x)/2,y:(r[n[0]].y+r[n[1]].y)/2},a[t].medianColor=D(a[t].median,p,v.transparentColor),a[t].medianLuminance=M(a[t].medianColor)});for(var t,e,n,o,i=[a.a,a.b,a.c].sort(function(t,e){return Math.abs(t.luminance-t.medianLuminance)-Math.abs(e.luminance-e.medianLuminance)}),s=i[0],u=i[0],c=s.median,f=[u],l=(t=u,n=(e=c).x-t.x,o=e.y-t.y,Math.sqrt(n*n+o*o)),h=1,d=v.gradientStops-2;h<d;h++){var g=h*(l/v.gradientStops)/l,y={x:u.x+g*(c.x-u.x),y:u.y+g*(c.y-u.y)};f.push(y)}f.push(c),r.gradient={x1:s.x,y1:s.y,x2:s.median.x,y2:s.median.y,colors:f.map(function(t){return D(t,p,v.transparentColor)})},v.stroke&&(r.strokeWidth=v.strokeWidth,r.lineJoin=v.lineJoin),a=null}),t}function J(t,e){if(E(t)){var n={width:t.width,height:t.height},r=_(t),a=_(t),o=function(t){for(var e,n=t.data.length,r=0;r<n;r+=4)e=.34*t.data[r]+.5*t.data[r+1]+.16*t.data[r+2],t.data[r]=e,t.data[r+1]=e,t.data[r+2]=e;return t}(function(t,e,n,r){var a,o,i,s,u,c,f,l,h,d,g,y,p,v,m,b,x,w,C,E,_,j,T,S,D=t.data,O=r+r+1,k=e-1,I=n-1,P=r+1,M=P*(P+1)/2,A=new R,J=A;for(i=1;i<O;i++)if(J=J.next=new R,i==P)var V=J;J.next=A;var L=null,N=null;f=c=0;var W=B[r],U=q[r];for(o=0;o<n;o++){for(b=x=w=C=l=h=d=g=0,y=P*(E=D[c]),p=P*(_=D[c+1]),v=P*(j=D[c+2]),m=P*(T=D[c+3]),l+=M*E,h+=M*_,d+=M*j,g+=M*T,J=A,i=0;i<P;i++)J.r=E,J.g=_,J.b=j,J.a=T,J=J.next;for(i=1;i<P;i++)s=c+((k<i?k:i)<<2),l+=(J.r=E=D[s])*(S=P-i),h+=(J.g=_=D[s+1])*S,d+=(J.b=j=D[s+2])*S,g+=(J.a=T=D[s+3])*S,b+=E,x+=_,w+=j,C+=T,J=J.next;for(L=A,N=V,a=0;a<e;a++)D[c+3]=T=g*W>>U,0!=T?(T=255/T,D[c]=(l*W>>U)*T,D[c+1]=(h*W>>U)*T,D[c+2]=(d*W>>U)*T):D[c]=D[c+1]=D[c+2]=0,l-=y,h-=p,d-=v,g-=m,y-=L.r,p-=L.g,v-=L.b,m-=L.a,s=f+((s=a+r+1)<k?s:k)<<2,l+=b+=L.r=D[s],h+=x+=L.g=D[s+1],d+=w+=L.b=D[s+2],g+=C+=L.a=D[s+3],L=L.next,y+=E=N.r,p+=_=N.g,v+=j=N.b,m+=T=N.a,b-=E,x-=_,w-=j,C-=T,N=N.next,c+=4;f+=e}for(a=0;a<e;a++){for(x=w=C=b=h=d=g=l=0,y=P*(E=D[c=a<<2]),p=P*(_=D[c+1]),v=P*(j=D[c+2]),m=P*(T=D[c+3]),l+=M*E,h+=M*_,d+=M*j,g+=M*T,J=A,i=0;i<P;i++)J.r=E,J.g=_,J.b=j,J.a=T,J=J.next;for(u=e,i=1;i<=r;i++)c=u+a<<2,l+=(J.r=E=D[c])*(S=P-i),h+=(J.g=_=D[c+1])*S,d+=(J.b=j=D[c+2])*S,g+=(J.a=T=D[c+3])*S,b+=E,x+=_,w+=j,C+=T,J=J.next,i<I&&(u+=e);for(c=a,L=A,N=V,o=0;o<n;o++)D[(s=c<<2)+3]=T=g*W>>U,0<T?(T=255/T,D[s]=(l*W>>U)*T,D[s+1]=(h*W>>U)*T,D[s+2]=(d*W>>U)*T):D[s]=D[s+1]=D[s+2]=0,l-=y,h-=p,d-=v,g-=m,y-=L.r,p-=L.g,v-=L.b,m-=L.a,s=a+((s=o+P)<I?s:I)*e<<2,l+=b+=L.r=D[s],h+=x+=L.g=D[s+1],d+=w+=L.b=D[s+2],g+=C+=L.a=D[s+3],L=L.next,y+=E=N.r,p+=_=N.g,v+=j=N.b,m+=T=N.a,b-=E,x-=_,w-=j,C-=T,N=N.next,c+=e}return t}(r,n.width,n.height,e.blur)),i=function(t,e,n,r,a){var o={},i=Math.max(~~(e*(1-n)),5),s=Math.round(Math.sqrt(i)),u=~~(r/s),c=~~(a/Math.round(Math.ceil(i/s))),f=0,l=0,h=0;for(h=0;h<a;h+=c)for(l=++f%2==0?~~(u/2):0;l<r;l+=u)l<r&&h<a&&T(~~(l+Math.cos(h)*c),~~(h+Math.sin(l)*u),o);T(0,0,o),T(r-1,0,o),T(r-1,a-1,o),T(0,a-1,o);var d=e-Object.keys(o).length,g=t.length,y=~~(g/d);if(0<e&&0<y){var p=0;for(p=0;p<g;p+=y)T(t[p].x,t[p].y,o)}return t=null,Object.keys(o).map(function(t){return o[t]})}(function(t,e){var n,r,a,o,i,s,u,c,f,l=t.width,h=t.height,d=t.data,g=[];for(r=0;r<h;r+=2)for(n=0;n<l;n+=2){for(c=f=0,a=-1;a<=1;a++)if(u=(s=r+a)*l,0<=s&&s<h)for(o=-1;o<=1;o++)0<=(i=n+o)&&i<l&&(c+=d[i+u<<2],f++);f&&(c/=f),e<c&&g.push({x:n,y:r})}return g}(y(o).toImageData(),e.threshold),e.vertexCount,e.accuracy,n.width,n.height),s=g(i);return s=S(s),e.transparentColor||(u=a,s=s.filter(function(t){return!k(D(O(t),u))})),s=(!0===e.fill&&!0===e.gradients?A:P)(s,a,e)}throw new Error("Can't work with the imageData provided. It seems to be corrupt.");var u}return r(function(t,e){t.exports=function(){function r(t){var e=typeof t;return t!==null&&(e==="object"||e==="function")}function u(t){return typeof t==="function"}var t=void 0;if(Array.isArray){t=Array.isArray}else{t=function(t){return Object.prototype.toString.call(t)==="[object Array]"}}var n=t,a=0,e=void 0,o=void 0,i=function t(e,n){x[a]=e;x[a+1]=n;a+=2;if(a===2){if(o){o(w)}else{E()}}};function s(t){o=t}function c(t){i=t}var f=typeof window!=="undefined"?window:undefined,l=f||{},h=l.MutationObserver||l.WebKitMutationObserver,d=typeof self==="undefined"&&typeof process!=="undefined"&&{}.toString.call(process)==="[object process]",g=typeof Uint8ClampedArray!=="undefined"&&typeof importScripts!=="undefined"&&typeof MessageChannel!=="undefined";function y(){return function(){return process.nextTick(w)}}function p(){if(typeof e!=="undefined"){return function(){e(w)}}return b()}function v(){var t=0;var e=new h(w);var n=document.createTextNode("");e.observe(n,{characterData:true});return function(){n.data=t=++t%2}}function m(){var t=new MessageChannel;t.port1.onmessage=w;return function(){return t.port2.postMessage(0)}}function b(){var t=setTimeout;return function(){return t(w,1)}}var x=new Array(1e3);function w(){for(var t=0;t<a;t+=2){var e=x[t];var n=x[t+1];e(n);x[t]=undefined;x[t+1]=undefined}a=0}function C(){try{var t=Function("return this")().require("vertx");e=t.runOnLoop||t.runOnContext;return p()}catch(t){return b()}}var E=void 0;if(d){E=y()}else if(h){E=v()}else if(g){E=m()}else if(f===undefined&&typeof at==="function"){E=C()}else{E=b()}function _(t,e){var n=this;var r=new this.constructor(S);if(r[T]===undefined){Y(r)}var a=n._state;if(a){var o=arguments[a-1];i(function(){return R(a,r,o,n._result)})}else{B(n,r,t,e)}return r}function j(t){var e=this;if(t&&typeof t==="object"&&t.constructor===e){return t}var n=new e(S);L(n,t);return n}var T=Math.random().toString(36).substring(2);function S(){}var D=void 0,O=1,k=2;function I(){return new TypeError("You cannot resolve a promise with itself")}function P(){return new TypeError("A promises callback cannot return that same promise.")}function M(t,e,n,r){try{t.call(e,n,r)}catch(t){return t}}function A(t,r,a){i(function(e){var n=false;var t=M(a,r,function(t){if(n){return}n=true;if(r!==t){L(e,t)}else{W(e,t)}},function(t){if(n){return}n=true;U(e,t)},"Settle: "+(e._label||" unknown promise"));if(!n&&t){n=true;U(e,t)}},t)}function J(e,t){if(t._state===O){W(e,t._result)}else if(t._state===k){U(e,t._result)}else{B(t,undefined,function(t){return L(e,t)},function(t){return U(e,t)})}}function V(t,e,n){if(e.constructor===t.constructor&&n===_&&e.constructor.resolve===j){J(t,e)}else{if(n===undefined){W(t,e)}else if(u(n)){A(t,e,n)}else{W(t,e)}}}function L(e,t){if(e===t){U(e,I())}else if(r(t)){var n=void 0;try{n=t.then}catch(t){U(e,t);return}V(e,t,n)}else{W(e,t)}}function N(t){if(t._onerror){t._onerror(t._result)}q(t)}function W(t,e){if(t._state!==D){return}t._result=e;t._state=O;if(t._subscribers.length!==0){i(q,t)}}function U(t,e){if(t._state!==D){return}t._state=k;t._result=e;i(N,t)}function B(t,e,n,r){var a=t._subscribers;var o=a.length;t._onerror=null;a[o]=e;a[o+O]=n;a[o+k]=r;if(o===0&&t._state){i(q,t)}}function q(t){var e=t._subscribers;var n=t._state;if(e.length===0){return}var r=void 0,a=void 0,o=t._result;for(var i=0;i<e.length;i+=3){r=e[i];a=e[i+n];if(r){R(n,r,a,o)}else{a(o)}}t._subscribers.length=0}function R(t,e,n,r){var a=u(n),o=void 0,i=void 0,s=true;if(a){try{o=n(r)}catch(t){s=false;i=t}if(e===o){U(e,P());return}}else{o=r}if(e._state!==D);else if(a&&s){L(e,o)}else if(s===false){U(e,i)}else if(t===O){W(e,o)}else if(t===k){U(e,o)}}function F(n,t){try{t(function t(e){L(n,e)},function t(e){U(n,e)})}catch(t){U(n,t)}}var G=0;function H(){return G++}function Y(t){t[T]=G++;t._state=undefined;t._result=undefined;t._subscribers=[]}function K(){return new Error("Array Methods must be provided an Array")}var z=function(){function t(t,e){this._instanceConstructor=t;this.promise=new t(S);if(!this.promise[T]){Y(this.promise)}if(n(e)){this.length=e.length;this._remaining=e.length;this._result=new Array(this.length);if(this.length===0){W(this.promise,this._result)}else{this.length=this.length||0;this._enumerate(e);if(this._remaining===0){W(this.promise,this._result)}}}else{U(this.promise,K())}}t.prototype._enumerate=function t(e){for(var n=0;this._state===D&&n<e.length;n++){this._eachEntry(e[n],n)}};t.prototype._eachEntry=function t(e,n){var r=this._instanceConstructor;var a=r.resolve;if(a===j){var o=void 0;var i=void 0;var s=false;try{o=e.then}catch(t){s=true;i=t}if(o===_&&e._state!==D){this._settledAt(e._state,n,e._result)}else if(typeof o!=="function"){this._remaining--;this._result[n]=e}else if(r===et){var u=new r(S);if(s){U(u,i)}else{V(u,e,o)}this._willSettleAt(u,n)}else{this._willSettleAt(new r(function(t){return t(e)}),n)}}else{this._willSettleAt(a(e),n)}};t.prototype._settledAt=function t(e,n,r){var a=this.promise;if(a._state===D){this._remaining--;if(e===k){U(a,r)}else{this._result[n]=r}}if(this._remaining===0){W(a,this._result)}};t.prototype._willSettleAt=function t(e,n){var r=this;B(e,undefined,function(t){return r._settledAt(O,n,t)},function(t){return r._settledAt(k,n,t)})};return t}();function Q(t){return new z(this,t).promise}function X(a){var o=this;if(n(a))return new o(function(t,e){for(var n=a.length,r=0;r<n;r++)o.resolve(a[r]).then(t,e)});else return new o(function(t,e){return e(new TypeError("You must pass an array to race."))})}function Z(t){var e=new this(S);return U(e,t),e}function $(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function tt(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var et=function(){function e(t){this[T]=H();this._result=this._state=undefined;this._subscribers=[];if(S!==t){typeof t!=="function"&&$();this instanceof e?F(this,t):tt()}}e.prototype.catch=function t(e){return this.then(null,e)};e.prototype.finally=function t(e){var n=this;var r=n.constructor;if(u(e)){return n.then(function(t){return r.resolve(e()).then(function(){return t})},function(t){return r.resolve(e()).then(function(){throw t})})}return n.then(e,e)};return e}();function nt(){var t=void 0;if(void 0!==rt)t=rt;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var n=null;try{n=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===n&&!e.cast)return}t.Promise=et}return et.prototype.then=_,et.all=function(t){return new z(this,t).promise},et.race=function(a){var o=this;return n(a)?new o(function(t,e){for(var n=a.length,r=0;r<n;r++)o.resolve(a[r]).then(t,e)}):new o(function(t,e){return e(new TypeError("You must pass an array to race."))})},et.resolve=j,et.reject=function(t){var e=new this(S);return U(e,t),e},et._setScheduler=function(t){o=t},et._setAsap=function(t){i=t},et._asap=i,et.polyfill=function(){var t=void 0;if(void 0!==rt)t=rt;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var n=null;try{n=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===n&&!e.cast)return}t.Promise=et},et.Promise=et}()}).polyfill(),function(r){r=p(r);var a,i,s=!1,u=!1,c=new Worker(URL.createObjectURL(new Blob(['function createCommonjsModule(t,e){return t(e={exports:{}},e.exports),e.exports}var delaunay=createCommonjsModule(function(t){function m(t,e,a){this.a=t,this.b=e,this.c=a;var n,r,o,i,s=e.x-t.x,u=e.y-t.y,c=a.x-t.x,h=a.y-t.y,l=s*(t.x+e.x)+u*(t.y+e.y),g=c*(t.x+a.x)+h*(t.y+a.y),d=2*(s*(a.y-e.y)-u*(a.x-e.x));Math.abs(d)<1e-6?(n=Math.min(t.x,e.x,a.x),r=Math.min(t.y,e.y,a.y),o=.5*(Math.max(t.x,e.x,a.x)-n),i=.5*(Math.max(t.y,e.y,a.y)-r),this.x=n+o,this.y=r+i):(this.x=(h*l-u*g)/d,this.y=(s*g-c*l)/d,o=this.x-t.x,i=this.y-t.y),this.r=o*o+i*i}function x(t,e){return e.x-t.x}function b(t){var e,a,n,r,o,i=t.length;t:for(;i;)for(a=t[--i],e=t[--i],n=i;n;)if(o=t[--n],e===(r=t[--n])&&a===o||e===o&&a===r){t.splice(i,2),t.splice(n,2),i-=2;continue t}}m.prototype.draw=function(t){t.beginPath(),t.moveTo(this.a.x,this.a.y),t.lineTo(this.b.x,this.b.y),t.lineTo(this.c.x,this.c.y),t.closePath(),t.stroke()},t.exports={Triangle:m,triangulate:function(t){if(t.length<3)return[];t.sort(x);for(var e=t.length-1,a=t[e].x,n=t[0].x,r=t[e].y,o=r;e--;)t[e].y<r&&(r=t[e].y),t[e].y>o&&(o=t[e].y);var i,s,u,c=n-a,h=o-r,l=h<c?c:h,g=.5*(n+a),d=.5*(o+r),f=[new m({x:g-20*l,y:d-l,__sentinel:!0},{x:g,y:d+20*l,__sentinel:!0},{x:g+20*l,y:d-l,__sentinel:!0})],y=[],p=[];for(e=t.length;e--;){for(p.length=0,i=f.length;i--;)0<(c=t[e].x-f[i].x)&&c*c>f[i].r?(y.push(f[i]),f.splice(i,1)):c*c+(h=t[e].y-f[i].y)*h>f[i].r||(p.push(f[i].a,f[i].b,f[i].b,f[i].c,f[i].c,f[i].a),f.splice(i,1));for(b(p),i=p.length;i;)u=p[--i],s=p[--i],f.push(new m(s,u,t[e]))}for(Array.prototype.push.apply(y,f),e=y.length;e--;)(y[e].a.__sentinel||y[e].b.__sentinel||y[e].c.__sentinel)&&y.splice(e,1);return y}}}),delaunay_1=delaunay.Triangle,delaunay_2=delaunay.triangulate,sobel=createCommonjsModule(function(t,e){function p(t){if(!(this instanceof p))return new p(t);var r=t.width,e=t.height,a=[[-1,0,1],[-2,0,2],[-1,0,1]],n=[[-1,-2,-1],[0,0,0],[1,2,1]],o=[],i=[];function s(n){return function(t,e,a){return n[4*(r*e+t)+(a=a||0)]}}var u,c,h=s(t.data);for(c=0;c<e;c++)for(u=0;u<r;u++){var l=(h(u,c,0)+h(u,c,1)+h(u,c,2))/3;i.push(l,l,l,255)}for(h=s(i),c=0;c<e;c++)for(u=0;u<r;u++){var g=a[0][0]*h(u-1,c-1)+a[0][1]*h(u,c-1)+a[0][2]*h(u+1,c-1)+a[1][0]*h(u-1,c)+a[1][1]*h(u,c)+a[1][2]*h(u+1,c)+a[2][0]*h(u-1,c+1)+a[2][1]*h(u,c+1)+a[2][2]*h(u+1,c+1),d=n[0][0]*h(u-1,c-1)+n[0][1]*h(u,c-1)+n[0][2]*h(u+1,c-1)+n[1][0]*h(u-1,c)+n[1][1]*h(u,c)+n[1][2]*h(u+1,c)+n[2][0]*h(u-1,c+1)+n[2][1]*h(u,c+1)+n[2][2]*h(u+1,c+1),f=Math.sqrt(g*g+d*d)>>>0;o.push(f,f,f,255)}var y=o;return"function"==typeof Uint8ClampedArray&&(y=new Uint8ClampedArray(o)),y.toImageData=function(){return p.toImageData(y,r,e)},y}function o(t,e,a){return{width:e,height:a,data:t}}p.toImageData=function(t,e,a){if("function"==typeof ImageData&&"[object Uint16Array]"===Object.prototype.toString.call(t))return new ImageData(t,e,a);if("object"!=typeof window||"object"!=typeof window.document)return new o(t,e,a);var n=document.createElement("canvas");if("function"!=typeof n.getContext)return new o(t,e,a);var r=n.getContext("2d").createImageData(e,a);return r.data.set(t),r},t.exports&&(e=t.exports=p),e.Sobel=p}),sobel_1=sobel.Sobel;function isImageData(t){return t&&"number"==typeof t.width&&"number"==typeof t.height&&t.data&&"number"==typeof t.data.length&&"object"==typeof t.data}var Canvas=function(t,e){void 0===t&&(t=300),void 0===e&&(e=150),"undefined"==typeof window?(this.canvasEl={width:t,height:e},this.ctx=null):(this.canvasEl=document.createElement("canvas"),this.canvasEl.width=t,this.canvasEl.height=e,this.ctx=this.canvasEl.getContext("2d"))},prototypeAccessors={width:{configurable:!0},height:{configurable:!0}};function copyImageData(e){if(isImageData(e)){if("undefined"==typeof Uint8ClampedArray){if("undefined"==typeof window)throw new Error("Can\'t copy imageData in webworker without Uint8ClampedArray support.");return copyImageDataWithCanvas(e)}var a,t=new Uint8ClampedArray(e.data);if("undefined"==typeof ImageData)return{width:e.width,height:e.height,data:t};try{a=new ImageData(t,e.width,e.height)}catch(t){if("undefined"==typeof window)throw new Error("Can\'t copy imageData in webworker without proper ImageData() support.");a=copyImageDataWithCanvas(e)}return a}throw new Error("Given imageData object is not useable.")}function copyImageDataWithCanvas(t){var e=new Canvas(t.width,t.height).getContext("2d");return e.putImageData(t,0,0),e.getImageData(0,0,t.width,t.height)}Canvas.prototype.getContext=function(){return this.ctx},Canvas.prototype.toDataURL=function(t,e,a){if("function"!=typeof a)return this.canvasEl.toDataURL(t,e);a(this.canvasEl.toDataURL(t,e))},prototypeAccessors.width.get=function(){return this.canvasEl.width},prototypeAccessors.width.set=function(t){this.canvasEl.width=t},prototypeAccessors.height.get=function(){return this.canvasEl.height},prototypeAccessors.height.set=function(t){this.canvasEl.height=t},Object.defineProperties(Canvas.prototype,prototypeAccessors),"undefined"!=typeof window&&(Canvas.Image=Image);var mul_table=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],shg_table=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function BlurStack(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}function stackblur(t,e,a,n,r,o){var i,s,u,c,h,l,g,d,f,y,p,m,x,b,v,w,C,D,P,I,j,O,E,M,T=t.data,k=o+o+1,_=n-1,B=r-1,S=o+1,A=S*(S+1)/2,U=new BlurStack,V=U;for(u=1;u<k;u++)if(V=V.next=new BlurStack,u==S)var W=V;V.next=U;var J=null,L=null;g=l=0;var N=mul_table[o],q=shg_table[o];for(s=0;s<r;s++){for(w=C=D=P=d=f=y=p=0,m=S*(I=T[l]),x=S*(j=T[l+1]),b=S*(O=T[l+2]),v=S*(E=T[l+3]),d+=A*I,f+=A*j,y+=A*O,p+=A*E,V=U,u=0;u<S;u++)V.r=I,V.g=j,V.b=O,V.a=E,V=V.next;for(u=1;u<S;u++)c=l+((_<u?_:u)<<2),d+=(V.r=I=T[c])*(M=S-u),f+=(V.g=j=T[c+1])*M,y+=(V.b=O=T[c+2])*M,p+=(V.a=E=T[c+3])*M,w+=I,C+=j,D+=O,P+=E,V=V.next;for(J=U,L=W,i=0;i<n;i++)T[l+3]=E=p*N>>q,0!=E?(E=255/E,T[l]=(d*N>>q)*E,T[l+1]=(f*N>>q)*E,T[l+2]=(y*N>>q)*E):T[l]=T[l+1]=T[l+2]=0,d-=m,f-=x,y-=b,p-=v,m-=J.r,x-=J.g,b-=J.b,v-=J.a,c=g+((c=i+o+1)<_?c:_)<<2,d+=w+=J.r=T[c],f+=C+=J.g=T[c+1],y+=D+=J.b=T[c+2],p+=P+=J.a=T[c+3],J=J.next,m+=I=L.r,x+=j=L.g,b+=O=L.b,v+=E=L.a,w-=I,C-=j,D-=O,P-=E,L=L.next,l+=4;g+=n}for(i=0;i<n;i++){for(C=D=P=w=f=y=p=d=0,m=S*(I=T[l=i<<2]),x=S*(j=T[l+1]),b=S*(O=T[l+2]),v=S*(E=T[l+3]),d+=A*I,f+=A*j,y+=A*O,p+=A*E,V=U,u=0;u<S;u++)V.r=I,V.g=j,V.b=O,V.a=E,V=V.next;for(h=n,u=1;u<=o;u++)l=h+i<<2,d+=(V.r=I=T[l])*(M=S-u),f+=(V.g=j=T[l+1])*M,y+=(V.b=O=T[l+2])*M,p+=(V.a=E=T[l+3])*M,w+=I,C+=j,D+=O,P+=E,V=V.next,u<B&&(h+=n);for(l=i,J=U,L=W,s=0;s<r;s++)T[(c=l<<2)+3]=E=p*N>>q,0<E?(E=255/E,T[c]=(d*N>>q)*E,T[c+1]=(f*N>>q)*E,T[c+2]=(y*N>>q)*E):T[c]=T[c+1]=T[c+2]=0,d-=m,f-=x,y-=b,p-=v,m-=J.r,x-=J.g,b-=J.b,v-=J.a,c=i+((c=s+S)<B?c:B)*n<<2,d+=w+=J.r=T[c],f+=C+=J.g=T[c+1],y+=D+=J.b=T[c+2],p+=P+=J.a=T[c+3],J=J.next,m+=I=L.r,x+=j=L.g,b+=O=L.b,v+=E=L.a,w-=I,C-=j,D-=O,P-=E,L=L.next,l+=n}return t}function greyscale(t){for(var e,a=t.data.length,n=0;n<a;n+=4)e=.34*t.data[n]+.5*t.data[n+1]+.16*t.data[n+2],t.data[n]=e,t.data[n+1]=e,t.data[n+2]=e;return t}function getEdgePoints(t,e){var a,n,r,o,i,s,u,c,h,l=t.width,g=t.height,d=t.data,f=[];for(n=0;n<g;n+=2)for(a=0;a<l;a+=2){for(c=h=0,r=-1;r<=1;r++)if(u=(s=n+r)*l,0<=s&&s<g)for(o=-1;o<=1;o++)0<=(i=a+o)&&i<l&&(c+=d[i+u<<2],h++);h&&(c/=h),e<c&&f.push({x:a,y:n})}return f}function clamp(t,e,a){return t<e?e:a<t?a:t}function addVertex(t,e,a){var n=t+"|"+e;a[n]||(a[n]={x:t,y:e}),n=null}function getVerticesFromPoints(t,e,a,n,r){var o={},i=Math.max(~~(e*(1-a)),5),s=Math.round(Math.sqrt(i)),u=~~(n/s),c=~~(r/Math.round(Math.ceil(i/s))),h=0,l=0,g=0;for(g=0;g<r;g+=c)for(l=++h%2==0?~~(u/2):0;l<n;l+=u)l<n&&g<r&&addVertex(~~(l+Math.cos(g)*c),~~(g+Math.sin(l)*u),o);addVertex(0,0,o),addVertex(n-1,0,o),addVertex(n-1,r-1,o),addVertex(0,r-1,o);var d=e-Object.keys(o).length,f=t.length,y=~~(f/d);if(0<e&&0<y){var p=0;for(p=0;p<f;p+=y)addVertex(t[p].x,t[p].y,o)}return t=null,Object.keys(o).map(function(t){return o[t]})}function getBoundingBox(t){var e=1/0,a=-1/0,n=1/0,r=-1/0;return t.forEach(function(t){t.x<e&&(e=t.x),t.y<n&&(n=t.y),t.x>a&&(a=t.x),t.y>r&&(r=t.y)}),{x:e,y:n,width:a-e,height:r-n}}function addBoundingBoxesToPolygons(t,e,a){return t.forEach(function(t){t.boundingBox=getBoundingBox([t.a,t.b,t.c])}),t.filter(function(t){return 0<t.boundingBox.width&&0<t.boundingBox.height})}function getColorByPos(t,e,a){var n=(0|clamp(t.x,1,e.width-2))+(0|clamp(t.y,1,e.height-2))*e.width<<2;n>=e.data.length&&(n=e.data.length-5);var r=e.data[n+3]/255;return a&&0==r?a:{r:e.data[n],g:e.data[n+1],b:e.data[n+2],a:r}}function polygonCenter(t){return{x:.33333*(t.a.x+t.b.x+t.c.x),y:.33333*(t.a.y+t.b.y+t.c.y)}}function isTransparent(t){return 0===t.a}var getOwnPropertySymbols=Object.getOwnPropertySymbols,hasOwnProperty=Object.prototype.hasOwnProperty,propIsEnumerable=Object.prototype.propertyIsEnumerable;function toObject(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}function shouldUseNative(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},a=0;a<10;a++)e["_"+String.fromCharCode(a)]=a;if("0123456789"!==Object.getOwnPropertyNames(e).map(function(t){return e[t]}).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach(function(t){n[t]=t}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(t){return!1}}var objectAssign=shouldUseNative()?Object.assign:function(t,e){for(var a,n,r=arguments,o=toObject(t),i=1;i<arguments.length;i++){for(var s in a=Object(r[i]))hasOwnProperty.call(a,s)&&(o[s]=a[s]);if(getOwnPropertySymbols){n=getOwnPropertySymbols(a);for(var u=0;u<n.length;u++)propIsEnumerable.call(a,n[u])&&(o[n[u]]=a[n[u]])}}return o};function strToColorArr(t){if("string"==typeof t){var e=[0,0,0,0];return"#"===t[0]&&(t.length<7&&(t="#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+(4<t.length?t[4]+t[4]:"")),e=[parseInt(t.substr(1,2),16),parseInt(t.substr(3,2),16),parseInt(t.substr(5,2),16),7<t.length?parseInt(t.substr(7,2),16)/255:1]),0===t.indexOf("rgb")&&(t.includes("rgba")||(t+=",1"),e=t.match(/[\\.\\d]+/g).map(function(t){return+t})),e}}function strToColor(t){var e=strToColorArr(t);return e?{r:e[0],g:e[1],b:e[2],a:e[3]}:void 0}function addColorToPolygons(t,a,e){function n(t,e){var a=isTransparent(t)&&u;return e&&!a?e:a?u:t}var r=e.fill,o=e.stroke,i=e.strokeWidth,s=e.lineJoin,u=e.transparentColor,c=!!r&&strToColor(r),h=!!o&&strToColor(o);return t.forEach(function(t){var e=getColorByPos(polygonCenter(t),a);r&&(t.fill=n(e,c)),o&&(t.strokeColor=n(e,h),t.strokeWidth=i,t.lineJoin=s)}),t}function luminance(t){var e=[t.r,t.g,t.b].map(function(t){return(t/=255)<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)});return.2126*e[0]+.7152*e[1]+.0722*e[2]}function distance(t,e){var a=e.x-t.x,n=e.y-t.y;return Math.sqrt(a*a+n*n)}function addGradientsToPolygons(t,g,d){return t.forEach(function(n){var r={};"abc".split("").forEach(function(t){var e=getColorByPos(n[t],g,d.transparentColor);r[t]={key:t,color:e,x:n[t].x,y:n[t].y},r[t].luminance=luminance(r[t].color);var a="abc".replace(t,"").split("");r[t].median={x:(n[a[0]].x+n[a[1]].x)/2,y:(n[a[0]].y+n[a[1]].y)/2},r[t].medianColor=getColorByPos(r[t].median,g,d.transparentColor),r[t].medianLuminance=luminance(r[t].medianColor)});for(var t=[r.a,r.b,r.c].sort(function(t,e){return Math.abs(t.luminance-t.medianLuminance)-Math.abs(e.luminance-e.medianLuminance)}),e=t[0],a=t[0],o=e.median,i=[a],s=distance(a,o),u=1,c=d.gradientStops-2;u<c;u++){var h=u*(s/d.gradientStops)/s,l={x:a.x+h*(o.x-a.x),y:a.y+h*(o.y-a.y)};i.push(l)}i.push(o),n.gradient={x1:e.x,y1:e.y,x2:e.median.x,y2:e.median.y,colors:i.map(function(t){return getColorByPos(t,g,d.transparentColor)})},d.stroke&&(n.strokeWidth=d.strokeWidth,n.lineJoin=d.lineJoin),r=null}),t}function filterTransparentPolygons(t,e){return t.filter(function(t){return!isTransparent(getColorByPos(polygonCenter(t),e))})}function imageDataToPolygons(t,e){if(isImageData(t)){var a={width:t.width,height:t.height},n=copyImageData(t),r=copyImageData(t),o=greyscale(stackblur(n,0,0,a.width,a.height,e.blur)),i=getVerticesFromPoints(getEdgePoints(sobel(o).toImageData(),e.threshold),e.vertexCount,e.accuracy,a.width,a.height),s=delaunay_2(i);return s=addBoundingBoxesToPolygons(s),e.transparentColor||(s=filterTransparentPolygons(s,r)),s=(!0===e.fill&&!0===e.gradients?addGradientsToPolygons:addColorToPolygons)(s,r,e)}throw new Error("Can\'t work with the imageData provided. It seems to be corrupt.")}onmessage=function(t){if(t.data.imageData&&t.data.params)try{var e=t.data.imageData;void 0===e.width&&"number"==typeof t.data.imageDataWidth&&(e.width=t.data.imageDataWidth),void 0===e.height&&"number"==typeof t.data.imageDataHeight&&(e.height=t.data.imageDataHeight);var a=imageDataToPolygons(t.data.imageData,t.data.params);self.postMessage({polygonJSONStr:JSON.stringify(a)})}catch(t){self.postMessage({err:t.message||t})}else t.data.imageData?self.postMessage({err:"Parameters are missing."}):self.postMessage({err:"ImageData is missing."});self.close()};'],{type:"text/javascript"}))),e={getParams:function(){return r},getInput:f,getOutput:l},n={fromImage:function(t){return h(v,t)},fromImageSync:function(t){return h(v,t,!0)},fromImageData:function(t){return h(function(t){return t},t)},fromImageDataSync:function(t){return h(function(t){return t},t,!0)}},o={toData:function(t){return d(function(t){return t},t)},toDataSync:function(t){return d(function(t){return t},t,!0)},toDataURL:function(t){return d(x,t)},toDataURLSync:function(t){return d(x,t,!0)},toImageData:function(t){return d(b,t)},toImageDataSync:function(t){return d(b,t,!0)},toSVG:function(t){return d(C,t)},toSVGSync:function(t){return d(C,t,!0)}};function f(){var t=m({},e);return a||m(t,n),t}function l(){var t=m({},e);return i||m(t,o),t}function h(n,r,t){return s=!!t,a=function(){return s?n(r):new Promise(function(t,e){try{t(n(r))}catch(t){e(t)}})},(g()?y:l)()}function d(a,o,t){return u=!!t,i=function(n,r){return u?a(n,r,o):new Promise(function(t,e){try{t(a(n,r,o))}catch(t){e(t)}})},(g()?y:f)()}function g(){return a&&i}function y(){if(s&&u){var t=a(r),e=J(t,r);return i(e,t)}return new Promise(function(e,t){var o,n;new Promise(function(t,e){if(s)try{t(a(n))}catch(t){e(t)}else a(n).then(t,e)}).then(function(t){return e=o=t,a=r,new Promise(function(n,r){c.addEventListener("message",function(t){if(t.data&&t.data.polygonJSONStr){var e=JSON.parse(t.data.polygonJSONStr);n(e)}else t.data&&t.data.err?r(t.data.err):r(t)}),c.postMessage({params:a,imageData:e,imageDataWidth:e.width,imageDataHeight:e.height})});var e,a},t).then(function(t){return n=t,r=o,new Promise(function(t,e){if(u)try{t(i(n,r))}catch(t){e(t)}else i(n,r).then(t,e)});var n,r},t).then(function(t){e(t)},t)})}return f()}});